<style type="text/css">

  #tab1 input[type="text"] {
    width: 150px;
  }

  #tab3 input[type="text"] {
    width: 150px;
  }

  #piping_table input[type="text"] {
    width: 50px;
  }

  .downstream_tables {
    width: auto;
  }

  .downstream_tables input[type="text"] {
    width: 50px;
  }

  .downstream_circuit_piping_table input[type="text"] {
    width: 50px;
  }
</style>
<%= form_for flow_element_sizing, :url => flow_element_sizing.new_record? ? admin_flow_element_sizings_path : admin_flow_element_sizing_path(flow_element_sizing), :html => {:style => 'width:auto;', :class => "form_flow_element"} do |f| %>
  <%= f.error_messages %>
  <% if flow_element_sizing.new_record? %>
    <%= f.hidden_field :company_id %>
    <%= f.hidden_field :client_id, :value => @user_project_settings.client_id %>
    <%= f.hidden_field :project_id, :value => @user_project_settings.project_id %>
    <%= f.hidden_field :process_unit_id, :value => @user_project_settings.process_unit_id %>
  <% end %>
  <div class="form-element-last">
		<span style="float:left;margin-right:40px;">
			<%= f.label :client_id %><br>
      <%= f.label :client_id, (flow_element_sizing.client.name rescue @user_project_settings.client.name), :style => "font-weight:bold" %>
		</span>
		<span style="float:left;margin-right:40px;">
			<%= f.label :project_id %><br>
      <%= f.label :project_id, (flow_element_sizing.project.project_num rescue @user_project_settings.project.project_num), :style => "font-weight:bold" %>
		</span>
		<span style="float:left;margin-right:40px;">
			<%= f.label :process_unit_id %><br>
      <%= f.label :process_unit_id, (flow_element_sizing.process_unit.name rescue @user_project_settings.process_unit.name), :style => "font-weight:bold" %>
		</span>		
		<span style="float:left;margin-right:40px;">
			<%= f.label :flow_element_tag %><br>
      <%= f.text_field :flow_element_tag %>
		</span>
    <% unless flow_element_sizing.new_record? %>
      <span style="float:left;margin-right:40px;">
        <%= label_tag :status %><br>
        <strong><%= sizing_status(flow_element_sizing) %></strong>
      </span>
      <span style="float:left;margin-right:40px;">
        <br>
        <%= sizing_status_request_button(flow_element_sizing) %>
      </span>
    <% end %>
    <div class="clear"></div>
  </div>
  <div class="hidden">
    <%= hidden_field_tag :tab %>
    <%= hidden_field_tag :calculate_btn %>
  </div>
  <div class="form-buttons">
    <%= f.submit flow_element_sizing.new_record? ? 'Create' : 'Update' %>&nbsp;&nbsp;
    <%= f.submit 'Save' if !flow_element_sizing.new_record? %>
  </div>

  <div>
  <ul class="simple-tabs">
    <li><a href="#tab1" tab="tab1">Upstream</a></li>
    <li><a href="#tab2" tab="tab2">Downstream</a></li>
    <li><a href="#tab3" tab="tab3">Orifice Design</a></li>
  </ul>
  <div class="tab_container">
  <div id="tab1" class="tab_content">
  <!-- Upstream -->
  <table>
    <tr>
      <td>
        <b><u>Process Basis</u></b>&nbsp;&nbsp;&nbsp;
        <%= f.collection_select :up_process_basis_id, @project.heat_and_material_balances, :id, :case, :prompt => true %>
      </td>
    </tr>
    <tr>
      <td>
        Upstream Condition Basis&nbsp;&nbsp;&nbsp;
        <%= f.select :upstream_condition_basis, options_for_select(@upstream_condition_basis.collect { |h| [raw(h[:name]), h[:value]] }, flow_element_sizing.upstream_condition_basis) %>
      </td>
    </tr>
  </table>

  <table id="upstream_conditions_maximum" class="upstream_coditions_table">
    <tr>
      <td colspan="4"><b><u>Upstream Conditions Maximum</u></b></td>
    </tr>
    <tr>
      <td width="25%">Stream No</td>
      <td width="25%"><%= f.collection_select :up_max_stream_no, @streams, :stream_no, :display_stream_no, :prompt => true %></td>
      <td width="25%">Stream Phase</td>
      <td width="25%"><%= f.select :up_max_stream_phase, options_for_select(StaticData.stream_phase, flow_element_sizing.up_max_stream_phase), :include_blank => true %></td>
    </tr>
    <tr>
      <td>Pressure</td>
      <td><%= f.text_field :up_max_pressure, :class => "pressure_general" %>&nbsp;<label class="pressure_general_unit"></label>
      </td>
      <td>Mass Vapor Fraction</td>
	  <td><%= f.text_field :up_max_mass_vapor_fraction, :class => "mass_vapor_fraction_dimensionless" %></td>
    </tr>
    <tr>
      <td>Temperature</td>
      <td><%= f.text_field :up_max_temperature, :class => "temperature_general" %>&nbsp;<label class="temperature_general_unit"></label>
      </td>
      <td>Mass Flow Rate</td>
      <td><%= f.text_field :up_max_mass_flow_rate, :class => "mass_flow_rate_general" %>&nbsp;<label class="mass_flow_rate_general_unit"></label>
      </td>
    </tr>
    <tr>
      <td colspan="2"><b><u>Vapor Properties</u></b></td>
      <td colspan="2"><b><u>Liquid Properties</u></b></td>
    </tr>
    <tr>
      <td>Density</td>
      <td><%= f.text_field :up_max_vp_density, :class => "density_general" %>&nbsp;<label class="density_general_unit"></label>
      </td>
      <td>Density</td>
      <td><%= f.text_field :up_max_lp_density, :class => "density_general" %>&nbsp;<label class="density_general_unit"></label>
      </td>
    </tr>
    <tr>
      <td>Viscosity</td>
      <td><%= f.text_field :up_max_vp_viscosity, :class => "viscosity_general" %>&nbsp;<label class="viscosity_general_unit"></label>
      </td>
      <td>Viscosity</td>
      <td><%= f.text_field :up_max_lp_viscosity, :class => "viscosity_general" %>&nbsp;<label class="viscosity_general_unit"></label>
      </td>
    </tr>
    <tr>
      <td>MW</td>
	  <td><%= f.text_field :up_max_vp_mw, :class => "molecular_weight_dimensionless" %></td>
      <td>Surface Tension</td>
      <td><%= f.text_field :up_max_lp_surface_tension, :class => "surface_tension_general" %>&nbsp;<label class="surface_tension_general_unit"></label>
      </td>
    </tr>
    <tr>
      <td>Cp/Cv</td>
	  <td><%= f.text_field :up_max_vp_cp_cv, :class => "specific_heat_capacity_ratio_dimensionless" %></td>
      <td colspan="2" rowspan="2"></td>
    </tr>
    <tr>
      <td>Z</td>
	  <td><%= f.text_field :up_max_vp_z, :class => "vapor_compressibility_dimensionless" %></td>
    </tr>
  </table>

  <table id="upstream_conditions_normal" class="upstream_coditions_table" style="display:none;">
    <tr>
      <td colspan="4"><b><u>Upstream Conditions Normal</u></b></td>
    </tr>
    <tr>
      <td width="25%">Stream No</td>
      <td width="25%"><%= f.collection_select :up_nor_stream_no, @streams, :stream_no, :display_stream_no, :prompt => true %></td>
      <td width="25%">Stream Phase</td>
      <td width="25%"><%= f.select :up_nor_stream_phase, options_for_select(StaticData.stream_phase, flow_element_sizing.up_nor_stream_phase), :include_blank => true %></td>
    </tr>
    <tr>
      <td>Pressure</td>
      <td><%= f.text_field :up_nor_pressure, :class => "pressure_general" %>&nbsp;<label class="pressure_general_unit"></label>
      </td>
      <td>Mass Vapor Fraction</td>
	  <td><%= f.text_field :up_nor_mass_vapor_fraction, :class => "mass_vapor_fraction_dimensionless" %></td>
    </tr>
    <tr>
      <td>Temperature</td>
      <td><%= f.text_field :up_nor_temperature, :class => "temperature_general" %>&nbsp;<label class="temperature_general_unit"></label>
      </td>
      <td>Mass Flow Rate</td>
      <td><%= f.text_field :up_nor_mass_flow_rate, :class => "mass_flow_rate_general" %>&nbsp;<label class="mass_flow_rate_general_unit"></label>
      </td>
    </tr>
    <tr>
      <td colspan="2"><b><u>Vapor Properties</u></b></td>
      <td colspan="2"><b><u>Liquid Properties</u></b></td>
    </tr>
    <tr>
      <td>Density</td>
      <td><%= f.text_field :up_nor_vp_density, :class => "density_general" %>&nbsp;<label class="density_general_unit"></label>
      </td>
      <td>Density</td>
      <td><%= f.text_field :up_nor_lp_density, :class => "density_general" %>&nbsp;<label class="density_general_unit"></label>
      </td>
    </tr>
    <tr>
      <td>Viscosity</td>
      <td><%= f.text_field :up_nor_vp_viscosity, :class => "viscosity_general" %>&nbsp;<label class="viscosity_general_unit"></label>
      </td>
      <td>Viscosity</td>
      <td><%= f.text_field :up_nor_lp_viscosity, :class => "viscosity_general" %>&nbsp;<label class="viscosity_general_unit"></label>
      </td>
    </tr>
    <tr>
      <td>MW</td>
      <td><%= f.text_field :up_nor_vp_mw %></td>
      <td>Surface Tension</td>
      <td><%= f.text_field :up_nor_lp_surface_tension, :class => "surface_tension_general" %>&nbsp;<label class="surface_tension_general_unit"></label>
      </td>

    </tr>
    <tr>
      <td>Cp/Cv</td>
      <td><%= f.text_field :up_nor_vp_cp_cv %></td>
      <td colspan="2" rowspan="2"></td>
    </tr>
    <tr>
      <td>Z</td>
      <td><%= f.text_field :up_nor_vp_z %></td>
    </tr>
  </table>

  <table id="upstream_conditions_minimum" class="upstream_coditions_table" style="display:none;">
    <tr>
      <td colspan="4"><b><u>Upstream Conditions Minimum</u></b></td>
    </tr>
    <tr>
      <td width="25%">Stream No</td>
      <td width="25%"><%= f.collection_select :up_min_stream_no, @streams, :stream_no, :display_stream_no, :prompt => true %></td>
      <td width="25%">Stream Phase</td>
      <td width="25%"><%= f.select :up_min_stream_phase, options_for_select(StaticData.stream_phase, flow_element_sizing.up_min_stream_phase), :include_blank => true %></td>
    </tr>
    <tr>
      <td>Pressure</td>
      <td><%= f.text_field :up_min_pressure, :class => "pressure_general" %>&nbsp;<label class="pressure_general_unit"></label>
      </td>
      <td>Mass Vapor Fraction</td>
	  <td><%= f.text_field :up_min_mass_vapor_fraction, :class => "mass_vapor_fraction_dimensionless" %></td>
    </tr>
    <tr>
      <td>Temperature</td>
      <td><%= f.text_field :up_min_temperature, :class => "temperature_general" %>&nbsp;<label class="temperature_general_unit"></label>
      </td>
      <td>Mass Flow Rate</td>
      <td><%= f.text_field :up_min_mass_flow_rate, :class => "mass_flow_rate_general" %>&nbsp;<label class="mass_flow_rate_general_unit"></label>
      </td>
    </tr>
    <tr>
      <td colspan="2"><b><u>Vapor Properties</u></b></td>
      <td colspan="2"><b><u>Liquid Properties</u></b></td>
    </tr>
    <tr>
      <td>Density</td>
      <td><%= f.text_field :up_min_vp_density, :class => "density_general" %>&nbsp;<label class="density_general_unit"></label>
      </td>
      <td>Density</td>
      <td><%= f.text_field :up_min_lp_density, :class => "density_general" %>&nbsp;<label class="density_general_unit"></label>
      </td>
    </tr>
    <tr>
      <td>Viscosity</td>
      <td><%= f.text_field :up_min_vp_viscosity, :class => "viscosity_general" %>&nbsp;<label class="viscosity_general_unit"></label>
      </td>
      <td>Viscosity</td>
      <td><%= f.text_field :up_min_lp_viscosity, :class => "viscosity_general" %>&nbsp;<label class="viscosity_general_unit"></label>
      </td>
    </tr>
    <tr>
      <td>MW</td>
      <td><%= f.text_field :up_min_vp_mw %></td>
      <td>Surface Tension</td>
      <td><%= f.text_field :up_min_lp_surface_tension, :class => "surface_tension_general" %>&nbsp;<label class="surface_tension_general_unit"></label>
      </td>
    </tr>
    <tr>
      <td>Cp/Cv</td>
      <td><%= f.text_field :up_min_vp_cp_cv %></td>
      <td colspan="2" rowspan="2"></td>
    </tr>
    <tr>
      <td>Z</td>
      <td><%= f.text_field :up_min_vp_z %></td>
    </tr>
  </table>

  <table>
    <tr>
      <td><b><u>Upstream Pipe Configuration</u></b></td>
    </tr>
    <tr>
      <td>
        <input type="button" value="Enter Circuit Piping" id="enter_piping">&nbsp;&nbsp;&nbsp;&nbsp;<input type="button" id="upstream_calculate" value="Calculate">
      </td>
    </tr>
  </table>

  <!-- inlet loss max -->
  <table class="upstream_coditions_table" id="inlet_loss_maximum">
    <tr>
      <td colspan="4"><b><u>Inlet Loss Maximum</u></b></td>
    </tr>
    <tr>
      <td>Fitting &Delta;P</td>
      <td><%= f.text_field :up_il_max_fitting_dp, :class => "pressure_differential" %>&nbsp;<label class="pressure_differential_unit"></label>
      </td>
      <td>Total Suction &Delta;P</td>
      <td><%= f.text_field :up_il_max_total_suction_dp, :class => "pressure_general" %>&nbsp;<label class="pressure_general_unit"></label>
      </td>
    </tr>
    <tr>
      <td>Equipment &Delta;P</td>
      <td><%= f.text_field :up_il_max_equipment_dp, :class => "pressure_differential" %>&nbsp;<label class="pressure_differential_unit"></label>
      </td>
      <td>Pressure @ Inlet Flange &Delta;P</td>
      <td><%= f.text_field :up_il_max_pressure_at_inlet_flange_dp, :class => "pressure_general" %>&nbsp;<label class="pressure_general_unit"></label>
      </td>
    </tr>
    <tr>
      <td>Control Valve &Delta;P</td>
      <td><%= f.text_field :up_il_max_control_valve_dp, :class => "pressure_differential" %>&nbsp;<label class="pressure_differential_unit"></label>
      </td>
      <td colspan="2" rowspan="2"></td>
    </tr>
    <tr>
      <td>Orifice &Delta;P</td>
      <td><%= f.text_field :up_il_max_orifice_dp, :class => "pressure_differential" %>&nbsp;<label class="pressure_differential_unit"></label>
      </td>
    </tr>
  </table>
  <!-- inlet loss max -->


  <!-- inlet loss min -->
  <table class="upstream_coditions_table" id="inlet_loss_minimum" style="display:none;">
    <tr>
      <td colspan="4"><b><u>Inlet Loss Minimum</u></b></td>
    </tr>
    <tr>
      <td>Fitting &Delta;P</td>
      <td><%= f.text_field :up_il_min_fitting_dp, :class => "pressure_differential" %>&nbsp;<label class="pressure_differential_unit"></label>
      </td>
      <td>Total Suction &Delta;P</td>
      <td><%= f.text_field :up_il_min_total_suction_dp, :class => "pressure_general" %>&nbsp;<label class="pressure_general_unit"></label>
      </td>
    </tr>
    <tr>
      <td>Equipment &Delta;P</td>
      <td><%= f.text_field :up_il_min_equipment_dp, :class => "pressure_differential" %>&nbsp;<label class="pressure_differential_unit"></label>
      </td>
      <td>Pressure @ Inlet Flange &Delta;P</td>
      <td><%= f.text_field :up_il_min_pressure_at_inlet_flange_dp, :class => "pressure_general" %>&nbsp;<label class="pressure_general_unit"></label>
      </td>
    </tr>
    <tr>
      <td>Control Valve &Delta;P</td>
      <td><%= f.text_field :up_il_min_control_valve_dp, :class => "pressure_differential" %>&nbsp;<label class="pressure_differential_unit"></label>
      </td>
      <td colspan="2" rowspan="2"></td>
    </tr>
    <tr>
      <td>Orifice &Delta;P</td>
      <td><%= f.text_field :up_il_min_orifice_dp, :class => "pressure_differential" %>&nbsp;<label class="pressure_differential_unit"></label>
      </td>
    </tr>
  </table>
  <!-- inlet loss min -->

  <!-- inlet loss nor -->
  <table class="upstream_coditions_table" id="inlet_loss_normal" style="display:none;">
    <tr>
      <td colspan="4"><b><u>Inlet Loss Normal</u></b></td>
    </tr>
    <tr>
      <td>Fitting &Delta;P</td>
      <td><%= f.text_field :up_il_nor_fitting_dp, :class => "pressure_differential" %>&nbsp;<label class="pressure_differential_unit"></label>
      </td>
      <td>Total Suction &Delta;P</td>
      <td><%= f.text_field :up_il_nor_total_suction_dp, :class => "pressure_general" %>&nbsp;<label class="pressure_general_unit"></label>
      </td>
    </tr>
    <tr>
      <td>Equipment &Delta;P</td>
      <td><%= f.text_field :up_il_nor_equipment_dp, :class => "pressure_differential" %>&nbsp;<label class="pressure_differential_unit"></label>
      </td>
      <td>Pressure @ Inlet Flange &Delta;P</td>
      <td><%= f.text_field :up_il_nor_pressure_at_inlet_flange_dp, :class => "pressure_general" %>&nbsp;<label class="pressure_general_unit"></label>
      </td>
    </tr>
    <tr>
      <td>Control Valve &Delta;P</td>
      <td><%= f.text_field :up_il_nor_control_valve_dp, :class => "pressure_differential" %>&nbsp;<label class="pressure_differential_unit"></label>
      </td>
      <td colspan="2" rowspan="2"></td>
    </tr>
    <tr>
      <td>Orifice &Delta;P</td>
      <td><%= f.text_field :up_il_nor_orifice_dp, :class => "pressure_differential" %>&nbsp;<label class="pressure_differential_unit"></label>
      </td>
    </tr>
  </table>
  <!-- inlet loss nor -->

  </div>
  <div id="tab2" class="tab_content">
  <!-- Downstream -->
  <div>
    Downstream Condition Basis
    <%= f.select :downstream_condition_basis, options_for_select(@upstream_condition_basis.collect { |h| [raw(h[:name]), h[:value]] }, flow_element_sizing.downstream_condition_basis) %>
  </div>

  <div id="downstream_maximum" class="downstream_tables_div">
    <b>Maximum</b>
    <table id="downstream_maximum_table" class="downstream_tables">
      <tr>
        <th rowspan="2">S.No</th>
        <th rowspan="2">Design Circuit</th>
        <th rowspan="2">Process Basis</th>
        <th rowspan="2">Destination Stream</th>
        <th rowspan="2">Circuit Piping</th>
        <th>Destination Pressure</th>
        <th>Fitting &Delta;P</th>
        <th>Equipment &Delta;P</th>
        <th>Control Valve &Delta;P</th>
        <th>Orifice &Delta;P</th>
        <th>Total System &Delta;P</th>
        <th>Pressure @ Outlet Flange</th>
        <th rowspan="2"></th>
      </tr>
      <tr>
        <th><label class="pressure_general_unit"></label></th>
        <th><label class="pressure_differential_unit"></label></th>
        <th><label class="pressure_differential_unit"></label></th>
        <th><label class="pressure_differential_unit"></label></th>
        <th><label class="pressure_differential_unit"></label></th>
        <th><label class="pressure_general_unit"></label></th>
        <th><label class="pressure_differential_unit"></label></th>
      </tr>
      <% flow_element_sizing.downstream_maximum.each_with_index do |dmax, i| %>
        <tr>
          <td>
            <b><%= i+1 %></b>
            <%= hidden_field_tag "flow_element_sizing[downstream_maximum][#{i+1}][id]", dmax.id, :id => "dmax_discharges_id_#{i+1}" %>
            <%= hidden_field_tag "flow_element_sizing[downstream_maximum][#{i+1}][path]", "#{i+1}", :id => "dmax_path_#{i+1}" %>
            <%= hidden_field_tag "flow_element_sizing[downstream_maximum][#{i+1}][delete]", false, :id => "dmax_discharges_delete_#{i+1}" %>
            <%= hidden_field_tag "flow_element_sizing[downstream_maximum][#{i+1}][downstream_condition_basis]", dmax.downstream_condition_basis %>
          </td>
          <td>
            <%= radio_button_tag "design_circuit", i+1, dmax.design_circuit, :id => "dmax_design_circuit_#{i+1}" %>
            <%= hidden_field_tag "flow_element_sizing[downstream_maximum][#{i+1}][design_circuit]", dmax.design_circuit, :id => "dmax_discharge_design_circuit_#{i+1}" %>
          </td>
          <td><%= select_tag "flow_element_sizing[downstream_maximum][#{i+1}][process_basis_id]", options_for_select(@company.heat_and_material_balances.collect { |p| [p[:case], p[:id]] }.insert(0, ''), dmax.process_basis_id), {:id => "dmax_discharge_process_basis_id_#{i+1}", :style => "width:100px;", :row_id => i+1} %></td>
          <td><%= select_tag "flow_element_sizing[downstream_maximum][#{i+1}][destination_stream_no]", options_for_select(Stream.get_stream_nos_by_process_basis(dmax.process_basis_id).collect { |p| [p.display_stream_no, p.stream_no] }.insert(0, ''), dmax.destination_stream_no), :id => "dmax_discharge_destination_stream_no_#{i+1}", :style => "width:100px;", :row_id => i+1 %></td>
          <td><input type="button" value="Circuit Piping" class="circuit_piping_btn" row_id="<%= i+1 %>"></td>
          <td><%= text_field_tag "flow_element_sizing[downstream_maximum][#{i+1}][destination_pressure]", dmax.destination_pressure, :id => "dmax_discharge_destination_pressure_#{i+1}", :class => "pressure_general" %></td>
          <td><%= text_field_tag "flow_element_sizing[downstream_maximum][#{i+1}][fitting_dp]", dmax.fitting_dp, :id => "dmax_discharge_fitting_dp_#{i+1}", :class => "pressure_differential" %></td>
          <td><%= text_field_tag "flow_element_sizing[downstream_maximum][#{i+1}][equipment_dp]", dmax.equipment_dp, :id => "dmax_discharge_equipment_dp_#{i+1}", :class => "pressure_differential" %></td>
          <td><%= text_field_tag "flow_element_sizing[downstream_maximum][#{i+1}][control_valve_dp]", dmax.control_valve_dp, :id => "dmax_discharge_control_valve_dp_#{i+1}", :class => "pressure_differential" %></td>
          <td><%= text_field_tag "flow_element_sizing[downstream_maximum][#{i+1}][orifice_dp]", dmax.orifice_dp, :id => "dmax_discharge_orifice_dp_#{i+1}", :class => "pressure_differential" %></td>
          <td><%= text_field_tag "flow_element_sizing[downstream_maximum][#{i+1}][total_system_dp]", dmax.total_system_dp, :id => "dmax_discharge_total_system_dp_#{i+1}", :class => "pressure_general" %></td>
          <td><%= text_field_tag "flow_element_sizing[downstream_maximum][#{i+1}][pressure_at_outlet_flange]", dmax.pressure_at_outlet_flange, :id => "dmax_discharge_pressure_at_outlet_flange_#{i+1}", :class => "pressure_differential" %></td>
          <td><%= link_to "X", "#", :class => "downstream_maximum_table_close_tr", :downstream_maximum_id => dmax.id, :row_id => "#{i+1}" %></td>
        </tr>
      <% end %>
      <% if flow_element_sizing.downstream_maximum.empty? %>
        <tr>
          <td>
            <b>1</b>
            <%= hidden_field_tag "flow_element_sizing[downstream_maximum][1][id]", "", :id => "dmax_discharges_id_1" %>
            <%= hidden_field_tag "flow_element_sizing[downstream_maximum][1][path]", "1", :id => "dmax_path_1" %>
            <%= hidden_field_tag "flow_element_sizing[downstream_maximum][1][downstream_condition_basis]", "maximum" %>
          </td>
          <td>
            <%= radio_button_tag "design_circuit", '1', false, :id => "dmax_design_circuit_1" %>
            <%= hidden_field_tag "flow_element_sizing[downstream_maximum][1][design_circuit]", "", :id => "dmax_discharge_design_circuit_1" %>
          </td>
          <td><%= select_tag "flow_element_sizing[downstream_maximum][1][process_basis_id]", options_for_select(@company.heat_and_material_balances.collect { |p| [p[:case], p[:id]] }.insert(0, '')), {:id => "dmax_discharge_process_basis_id_1", :style => "width:100px;", :row_id => 1} %></td>
          <td><%= select_tag "flow_element_sizing[downstream_maximum][1][destination_stream_no]", options_for_select(@streams.collect { |p| [p[:stream_no], p[:display_stream_no]] }.insert(0, '')), :id => "dmax_discharge_destination_stream_no_1", :style => "width:100px;", :row_id => 1 %></td>
          <td><input type="button" value="Circuit Piping" class="circuit_piping_btn" row_id="1"></td>
          <td><%= text_field_tag "flow_element_sizing[downstream_maximum][1][destination_pressure]", "", :id => "dmax_discharge_destination_pressure_1", :class => "pressure_general" %></td>
          <td><%= text_field_tag "flow_element_sizing[downstream_maximum][1][fitting_dp]", "", :id => "dmax_discharge_fitting_dp_1", :class => "pressure_differential" %></td>
          <td><%= text_field_tag "flow_element_sizing[downstream_maximum][1][equipment_dp]", "", :id => "dmax_discharge_equipment_dp_1", :class => "pressure_differential" %></td>
          <td><%= text_field_tag "flow_element_sizing[downstream_maximum][1][control_valve_dp]", "", :id => "dmax_discharge_control_valve_dp_1", :class => "pressure_differential" %></td>
          <td><%= text_field_tag "flow_element_sizing[downstream_maximum][1][orifice_dp]", "", :id => "dmax_discharge_orifice_dp_1", :class => "pressure_differential" %></td>
          <td><%= text_field_tag "flow_element_sizing[downstream_maximum][1][total_system_dp]", "", :id => "dmax_discharge_total_system_dp_1", :class => "pressure_general" %></td>
          <td><%= text_field_tag "flow_element_sizing[downstream_maximum][1][pressure_at_outlet_flange]", "", :id => "dmax_discharge_pressure_at_outlet_flange_1", :class => "pressure_differential" %></td>
          <td><%= link_to "X", "#", :class => "downstream_maximum_table_close_tr", :downstream_maximum_id => "0", :row_id => "1" %></td>
        </tr>
      <% end %>
    </table>

    <%= link_to "Add More", "#", :id => "add_new_downstream_maximum_row", :class => "add_new_downstream_row" %>

    <table class="hidden" id="new_downstream_maximum_row">
      <tr>
        <td>
          <b>#x#</b>
          <%= hidden_field_tag "flow_element_sizing[downstream_maximum][#x#][id]", "", :id => "dmax_discharges_id_#x#" %>
          <%= hidden_field_tag "flow_element_sizing[downstream_maximum][#x#][path]", "1", :id => "dmax_path_#x#" %>
          <%= hidden_field_tag "flow_element_sizing[downstream_maximum][#x#][downstream_condition_basis]", "maximum" %>
        </td>
        <td>
          <%= radio_button_tag "design_circuit", '#x#', false, :id => "dmax_design_circuit_#x#" %>
          <%= hidden_field_tag "flow_element_sizing[downstream_maximum][#x#][design_circuit]", "", :id => "dmax_discharge_design_circuit_#x#" %>
        </td>
        <td><%= select_tag "flow_element_sizing[downstream_maximum][#x#][process_basis_id]", options_for_select(@company.heat_and_material_balances.collect { |p| [p[:case], p[:id]] }.insert(0, '')), {:id => "dmax_discharge_process_basis_id_#x#", :style => "width:100px;", :row_id => "#x#"} %></td>
        <td><%= select_tag "flow_element_sizing[downstream_maximum][#x#][destination_stream_no]", options_for_select(@streams.collect { |p| [p[:stream_no], p[:display_stream_no]] }.insert(0, '')), :id => "dmax_discharge_destination_stream_no_#x#", :style => "width:100px;", :row_id => "#x#" %></td>
        <td><input type="button" value="Circuit Piping" class="circuit_piping_btn" row_id="#x#"></td>
        <td><%= text_field_tag "flow_element_sizing[downstream_maximum][#x#][destination_pressure]", "", :id => "dmax_discharge_destination_pressure_#x#", :class => "pressure_general" %></td>
        <td><%= text_field_tag "flow_element_sizing[downstream_maximum][#x#][fitting_dp]", "", :id => "dmax_discharge_fitting_dp_#x#", :class => "pressure_differential" %></td>
        <td><%= text_field_tag "flow_element_sizing[downstream_maximum][#x#][equipment_dp]", "", :id => "dmax_discharge_equipment_dp_#x#", :class => "pressure_differential" %></td>
        <td><%= text_field_tag "flow_element_sizing[downstream_maximum][#x#][control_valve_dp]", "", :id => "dmax_discharge_control_valve_dp_#x#", :class => "pressure_differential" %></td>
        <td><%= text_field_tag "flow_element_sizing[downstream_maximum][#x#][orifice_dp]", "", :id => "dmax_discharge_orifice_dp_#x#", :class => "pressure_differential" %></td>
        <td><%= text_field_tag "flow_element_sizing[downstream_maximum][#x#][total_system_dp]", "", :id => "dmax_discharge_total_system_dp_#x#", :class => "pressure_general" %></td>
        <td><%= text_field_tag "flow_element_sizing[downstream_maximum][#x#][pressure_at_outlet_flange]", "", :id => "dmax_discharge_pressure_at_outlet_flange_#x#", :class => "pressure_differential" %></td>
        <td><%= link_to "X", "#", :class => "downstream_maximum_table_close_tr", :downstream_maximum_id => "0", :row_id => "#x#" %></td>
      </tr>
    </table>
  </div>

  <div id="downstream_normal" class="downstream_tables_div" style="display:none;">
    <b>Normal</b>
    <table id="downstream_normal_table" class="downstream_tables">
      <tr>
        <th rowspan="2">S.No</th>
        <th rowspan="2">Design Circuit</th>
        <th rowspan="2">Process Basis</th>
        <th rowspan="2">Destination Stream</th>
        <th rowspan="2">Circuit Piping</th>
        <th>Destination Pressure</th>
        <th>Fitting &Delta;P</th>
        <th>Equipment &Delta;P</th>
        <th>Control Valve &Delta;P</th>
        <th>Orifice &Delta;P</th>
        <th>Total System &Delta;P</th>
        <th>Pressure @ Outlet Flange</th>
        <th rowspan="2"></th>
      </tr>
      <tr>
        <th><label class="pressure_general_unit"></label></th>
        <th><label class="pressure_differential_unit"></label></th>
        <th><label class="pressure_differential_unit"></label></th>
        <th><label class="pressure_differential_unit"></label></th>
        <th><label class="pressure_differential_unit"></label></th>
        <th><label class="pressure_general_unit"></label></th>
        <th><label class="pressure_differential_unit"></label></th>
      </tr>
      <% flow_element_sizing.downstream_normal.each_with_index do |dnor, i| %>
        <tr>
          <td>
            <b><%= i+1 %></b>
            <%= hidden_field_tag "flow_element_sizing[downstream_normal][#{i+1}][id]", dnor.id, :id => "dnor_discharges_id_#{i+1}" %>
            <%= hidden_field_tag "flow_element_sizing[downstream_normal][#{i+1}][path]", "#{i+1}", :id => "dnor_path_#{i+1}" %>
            <%= hidden_field_tag "flow_element_sizing[downstream_normal][#{i+1}][delete]", false, :id => "dnor_discharges_delete_#{i+1}" %>
            <%= hidden_field_tag "flow_element_sizing[downstream_normal][#{i+1}][downstream_condition_basis]", dnor.downstream_condition_basis %>
          </td>
          <td>
            <%= radio_button_tag "design_circuit", i+1, dnor.design_circuit, :id => "design_circuit_#{i+1}" %>
            <%= hidden_field_tag "flow_element_sizing[downstream_normal][#{i+1}][design_circuit]", dnor.design_circuit, :id => "dnor_discharge_design_circuit_#{i+1}" %>
          </td>
          <td><%= select_tag "flow_element_sizing[downstream_normal][#{i+1}][process_basis_id]", options_for_select(@company.heat_and_material_balances.collect { |p| [p[:case], p[:id]] }.insert(0, ''), dnor.process_basis_id), {:id => "dnor_discharge_process_basis_id_#{i+1}", :style => "width:100px;", :row_id => i+1} %></td>
          <td><%= select_tag "flow_element_sizing[downstream_normal][#{i+1}][destination_stream_no]", options_for_select(Stream.get_stream_nos_by_process_basis(dnor.process_basis_id).collect { |p| [p.display_stream_no, p.stream_no] }.insert(0, ''), dnor.destination_stream_no), :id => "dnor_discharge_destination_stream_no_#{i+1}", :style => "width:100px;", :row_id => i+1 %></td>
          <td><input type="button" value="Circuit Piping" class="circuit_piping_btn" row_id="<%= i+1 %>"></td>
          <td><%= text_field_tag "flow_element_sizing[downstream_normal][#{i+1}][destination_pressure]", dnor.destination_pressure, :id => "dnor_discharge_destination_pressure_#{i+1}", :class => "pressure_general" %></td>
          <td><%= text_field_tag "flow_element_sizing[downstream_normal][#{i+1}][fitting_dp]", dnor.fitting_dp, :id => "dnor_discharge_fitting_dp_#{i+1}", :class => "pressure_differential" %></td>
          <td><%= text_field_tag "flow_element_sizing[downstream_normal][#{i+1}][equipment_dp]", dnor.equipment_dp, :id => "dnor_discharge_equipment_dp_#{i+1}", :class => "pressure_differential" %></td>
          <td><%= text_field_tag "flow_element_sizing[downstream_normal][#{i+1}][control_valve_dp]", dnor.control_valve_dp, :id => "dnor_discharge_control_valve_dp_#{i+1}", :class => "pressure_differential" %></td>
          <td><%= text_field_tag "flow_element_sizing[downstream_normal][#{i+1}][orifice_dp]", dnor.orifice_dp, :id => "dnor_discharge_orifice_dp_#{i+1}", :class => "pressure_differential" %></td>
          <td><%= text_field_tag "flow_element_sizing[downstream_normal][#{i+1}][total_system_dp]", dnor.total_system_dp, :id => "dnor_discharge_total_system_dp_#{i+1}", :class => "pressure_general" %></td>
          <td><%= text_field_tag "flow_element_sizing[downstream_normal][#{i+1}][pressure_at_outlet_flange]", dnor.pressure_at_outlet_flange, :id => "dnor_discharge_pressure_at_outlet_flange_#{i+1}", :class => "pressure_differential" %></td>
          <td><%= link_to "X", "#", :class => "downstream_normal_table_close_tr", :downstream_normal_id => dnor.id, :row_id => "#{i+1}" %></td>
        </tr>
      <% end %>
      <% if flow_element_sizing.downstream_normal.empty? %>
        <tr>
          <td>
            <b>1</b>
            <%= hidden_field_tag "flow_element_sizing[downstream_normal][1][id]", "", :id => "dnor_discharges_id_1" %>
            <%= hidden_field_tag "flow_element_sizing[downstream_normal][1][path]", "", :id => "dnor_path_1" %>
            <%= hidden_field_tag "flow_element_sizing[downstream_normal][1][downstream_condition_basis]", "normal" %>
          </td>
          <td>
            <%= radio_button_tag "design_circuit", '1', false, :id => "dnor_design_circuit_1" %>
            <%= hidden_field_tag "flow_element_sizing[downstream_normal][1][design_circuit]", "", :id => "dnor_discharge_design_circuit_1" %>
          </td>
          <td><%= select_tag "flow_element_sizing[downstream_normal][1][process_basis_id]", options_for_select(@company.heat_and_material_balances.collect { |p| [p[:case], p[:id]] }.insert(0, '')), {:id => "dnor_discharge_process_basis_id_1", :style => "width:100px;", :row_id => 1} %></td>
          <td><%= select_tag "flow_element_sizing[downstream_normal][1][destination_stream_no]", options_for_select(@streams.collect { |p| [p[:stream_no], p[:display_stream_no]] }.insert(0, '')), :id => "dnor_discharge_destination_stream_no_1", :style => "width:100px;", :row_id => 1 %></td>
          <td><input type="button" value="Circuit Piping" class="circuit_piping_btn" row_id="1"></td>
          <td><%= text_field_tag "flow_element_sizing[downstream_normal][1][destination_pressure]", "", :id => "dnor_discharge_destination_pressure_1", :class => "pressure_general" %></td>
          <td><%= text_field_tag "flow_element_sizing[downstream_normal][1][fitting_dp]", "", :id => "dnor_discharge_fitting_dp_1", :class => "pressure_differential" %></td>
          <td><%= text_field_tag "flow_element_sizing[downstream_normal][1][equipment_dp]", "", :id => "dnor_discharge_equipment_dp_1", :class => "pressure_differential" %></td>
          <td><%= text_field_tag "flow_element_sizing[downstream_normal][1][control_valve_dp]", "", :id => "dnor_discharge_control_valve_dp_1", :class => "pressure_differential" %></td>
          <td><%= text_field_tag "flow_element_sizing[downstream_normal][1][orifice_dp]", "", :id => "dnor_discharge_orifice_dp_1", :class => "pressure_differential" %></td>
          <td><%= text_field_tag "flow_element_sizing[downstream_normal][1][total_system_dp]", "", :id => "dnor_discharge_total_system_dp_1", :class => "pressure_general" %></td>
          <td><%= text_field_tag "flow_element_sizing[downstream_normal][1][pressure_at_outlet_flange]", "", :id => "dnor_discharge_pressure_at_outlet_flange_1", :class => "pressure_differential" %></td>
          <td><%= link_to "X", "#", :class => "downstream_normal_table_close_tr", :downstream_normal_id => "0", :row_id => "1" %></td>
        </tr>
      <% end %>
    </table>

    <%= link_to "Add More", "#", :id => "add_new_downstream_normal_row", :class => "add_new_downstream_row" %>

    <table class="hidden" id="new_downstream_normal_row">
      <tr>
        <td>
          <b>#x#</b>
          <%= hidden_field_tag "flow_element_sizing[downstream_normal][#x#][id]", "", :id => "dnor_discharges_id_#x#" %>
          <%= hidden_field_tag "flow_element_sizing[downstream_normal][#x#][path]", "#x#", :id => "dnor_path_#x#" %>
          <%= hidden_field_tag "flow_element_sizing[downstream_normal][#x#][downstream_condition_basis]", "normal" %>
        </td>
        <td>
          <%= radio_button_tag "design_circuit", '#x#', false, :id => "dnor_design_circuit_#x#" %>
          <%= hidden_field_tag "flow_element_sizing[downstream_normal][#x#][design_circuit]", "", :id => "dnor_discharge_design_circuit_#x#" %>
        </td>
        <td><%= select_tag "flow_element_sizing[downstream_normal][#x#][process_basis_id]", options_for_select(@company.heat_and_material_balances.collect { |p| [p[:case], p[:id]] }.insert(0, '')), {:id => "dnor_discharge_process_basis_id_#x#", :style => "width:100px;", :row_id => "#x#"} %></td>
        <td><%= select_tag "flow_element_sizing[downstream_normal][#x#][destination_stream_no]", options_for_select(@streams.collect { |p| [p[:stream_no], p[:display_stream_no]] }.insert(0, '')), :id => "dnor_discharge_destination_stream_no_#x#", :style => "width:100px;", :row_id => "#x#" %></td>
        <td><input type="button" value="Circuit Piping" class="circuit_piping_btn" row_id="#x#"></td>
        <td><%= text_field_tag "flow_element_sizing[downstream_normal][#x#][destination_pressure]", "", :id => "dnor_discharge_destination_pressure_#x#", :class => "pressure_general" %></td>
        <td><%= text_field_tag "flow_element_sizing[downstream_normal][#x#][fitting_dp]", "", :id => "dnor_discharge_fitting_dp_#x#", :class => "pressure_differential" %></td>
        <td><%= text_field_tag "flow_element_sizing[downstream_normal][#x#][equipment_dp]", "", :id => "dnor_discharge_equipment_dp_#x#", :class => "pressure_differential" %></td>
        <td><%= text_field_tag "flow_element_sizing[downstream_normal][#x#][control_valve_dp]", "", :id => "dnor_discharge_control_valve_dp_#x#", :class => "pressure_differential" %></td>
        <td><%= text_field_tag "flow_element_sizing[downstream_normal][#x#][orifice_dp]", "", :id => "dnor_discharge_orifice_dp_#x#", :class => "pressure_general" %></td>
        <td><%= text_field_tag "flow_element_sizing[downstream_normal][#x#][total_system_dp]", "", :id => "dnor_discharge_total_system_dp_#x#", :class => "pressure_differential" %></td>
        <td><%= text_field_tag "flow_element_sizing[downstream_normal][#x#][pressure_at_outlet_flange]", "", :id => "dnor_discharge_pressure_at_outlet_flange_#x#" %></td>
        <td><%= link_to "X", "#", :class => "downstream_normal_table_close_tr", :downstream_normal_id => "0", :row_id => "#x#" %></td>
      </tr>
    </table>

  </div>

  <div id="downstream_minimum" class="downstream_tables_div" style="display:none;">
    <b>Minimum</b>
    <table id="downstream_minimum_table" class="downstream_tables">
      <tr>
        <th rowspan="2">S.No</th>
        <th rowspan="2">Design Circuit</th>
        <th rowspan="2">Process Basis</th>
        <th rowspan="2">Destination Stream</th>
        <th rowspan="2">Circuit Piping</th>
        <th>Destination Pressure</th>
        <th>Fitting &Delta;P</th>
        <th>Equipment &Delta;P</th>
        <th>Control Valve &Delta;P</th>
        <th>Orifice &Delta;P</th>
        <th>Total System &Delta;P</th>
        <th>Pressure @ Outlet Flange</th>
        <th rowspan="2"></th>
      </tr>
      <tr>
        <th><label class="pressure_general_unit"></label></th>
        <th><label class="pressure_differential_unit"></label></th>
        <th><label class="pressure_differential_unit"></label></th>
        <th><label class="pressure_differential_unit"></label></th>
        <th><label class="pressure_differential_unit"></label></th>
        <th><label class="pressure_general_unit"></label></th>
        <th><label class="pressure_differential_unit"></label></th>
      </tr>
      <% flow_element_sizing.downstream_minimum.each_with_index do |dmin, i| %>
        <tr>
          <td>
            <b><%= i+1 %></b>
            <%= hidden_field_tag "flow_element_sizing[downstream_minimum][#{i+1}][id]", dmin.id, :id => "dmin_discharges_id_#{i+1}" %>
            <%= hidden_field_tag "flow_element_sizing[downstream_minimum][#{i+1}][path]", "#{i+1}", :id => "dmin_path_#{i+1}" %>
            <%= hidden_field_tag "flow_element_sizing[downstream_minimum][#{i+1}][delete]", false, :id => "dmin_discharges_delete_#{i+1}" %>
            <%= hidden_field_tag "flow_element_sizing[downstream_minimum][#{i+1}][downstream_condition_basis]", dmin.downstream_condition_basis %>
          </td>
          <td>
            <%= radio_button_tag "design_circuit", i+1, dmin.design_circuit, :id => "dmin_design_circuit_#{i+1}" %>
            <%= hidden_field_tag "flow_element_sizing[downstream_minimum][#{i+1}][design_circuit]", dmin.design_circuit, :id => "dmin_discharge_design_circuit_#{i+1}" %>
          </td>
          <td><%= select_tag "flow_element_sizing[downstream_minimum][#{i+1}][process_basis_id]", options_for_select(@company.heat_and_material_balances.collect { |p| [p[:case], p[:id]] }.insert(0, ''), dmin.process_basis_id), {:id => "dmin_discharge_process_basis_id_#{i+1}", :style => "width:100px;", :row_id => i+1} %></td>
          <td><%= select_tag "flow_element_sizing[downstream_minimum][#{i+1}][destination_stream_no]", options_for_select(Stream.get_stream_nos_by_process_basis(dmin.process_basis_id).collect { |p| [p.display_stream_no, p.stream_no] }.insert(0, ''), dmin.destination_stream_no), :id => "dmin_discharge_destination_stream_no_#{i+1}", :style => "width:100px;", :row_id => i+1 %></td>
          <td><input type="button" value="Circuit Piping" class="circuit_piping_btn" row_id="<%= i+1 %>"></td>
          <td><%= text_field_tag "flow_element_sizing[downstream_minimum][#{i+1}][destination_pressure]", dmin.destination_pressure, :id => "dmin_discharge_destination_pressure_#{i+1}", :class => "pressure_general" %></td>
          <td><%= text_field_tag "flow_element_sizing[downstream_minimum][#{i+1}][fitting_dp]", dmin.fitting_dp, :id => "dmin_discharge_fitting_dp_#{i+1}", :class => "pressure_differential" %></td>
          <td><%= text_field_tag "flow_element_sizing[downstream_minimum][#{i+1}][equipment_dp]", dmin.equipment_dp, :id => "dmin_discharge_equipment_dp_#{i+1}", :class => "pressure_differential" %></td>
          <td><%= text_field_tag "flow_element_sizing[downstream_minimum][#{i+1}][control_valve_dp]", dmin.control_valve_dp, :id => "dmin_discharge_control_valve_dp_#{i+1}", :class => "pressure_differential" %></td>
          <td><%= text_field_tag "flow_element_sizing[downstream_minimum][#{i+1}][orifice_dp]", dmin.orifice_dp, :id => "dmin_discharge_orifice_dp_#{i+1}", :class => "pressure_differential" %></td>
          <td><%= text_field_tag "flow_element_sizing[downstream_minimum][#{i+1}][total_system_dp]", dmin.total_system_dp, :id => "dmin_discharge_total_system_dp_#{i+1}", :class => "pressure_general" %></td>
          <td><%= text_field_tag "flow_element_sizing[downstream_minimum][#{i+1}][pressure_at_outlet_flange]", dmin.pressure_at_outlet_flange, :id => "dmin_discharge_pressure_at_outlet_flange_#{i+1}", :class => "pressure_differential" %></td>
          <td><%= link_to "X", "#", :class => "downstream_minimum_table_close_tr", :downstream_minimum_id => dmin.id, :row_id => "#{i+1}" %></td>
        </tr>
      <% end %>
      <% if flow_element_sizing.downstream_minimum.empty? %>
        <tr>
          <td>
            <b>1</b>
            <%= hidden_field_tag "flow_element_sizing[downstream_minimum][1][id]", "", :id => "dmin_discharges_id_1" %>
            <%= hidden_field_tag "flow_element_sizing[downstream_minimum][1][path]", "1", :id => "dmin_path_1" %>
            <%= hidden_field_tag "flow_element_sizing[downstream_minimum][1][downstream_condition_basis]", "minimum" %>
          </td>
          <td>
            <%= radio_button_tag "design_circuit", '1', false, :id => "dnor_design_circuit_1" %>
            <%= hidden_field_tag "flow_element_sizing[downstream_minimum][1][design_circuit]", "", :id => "dmin_discharge_design_circuit_1" %>
          </td>
          <td><%= select_tag "flow_element_sizing[downstream_minimum][1][process_basis_id]", options_for_select(@company.heat_and_material_balances.collect { |p| [p[:case], p[:id]] }.insert(0, '')), {:id => "dmin_discharge_process_basis_id_1", :style => "width:100px;", :row_id => 1} %></td>
          <td><%= select_tag "flow_element_sizing[downstream_minimum][1][destination_stream_no]", options_for_select(@streams.collect { |p| [p[:stream_no], p[:display_stream_no]] }.insert(0, '')), :id => "dmin_discharge_destination_stream_no_1", :style => "width:100px;", :row_id => 1 %></td>
          <td><input type="button" value="Circuit Piping" class="circuit_piping_btn" row_id="1"></td>
          <td><%= text_field_tag "flow_element_sizing[downstream_minimum][1][destination_pressure]", "", :id => "dmin_discharge_destination_pressure_1", :class => "pressure_general" %></td>
          <td><%= text_field_tag "flow_element_sizing[downstream_minimum][1][fitting_dp]", "", :id => "dmin_discharge_fitting_dp_1", :class => "pressure_differential" %></td>
          <td><%= text_field_tag "flow_element_sizing[downstream_minimum][1][equipment_dp]", "", :id => "dmin_discharge_equipment_dp_1", :class => "pressure_differential" %></td>
          <td><%= text_field_tag "flow_element_sizing[downstream_minimum][1][control_valve_dp]", "", :id => "dmin_discharge_control_valve_dp_1", :class => "pressure_differential" %></td>
          <td><%= text_field_tag "flow_element_sizing[downstream_minimum][1][orifice_dp]", "", :id => "dmin_discharge_orifice_dp_1", :class => "pressure_differential" %></td>
          <td><%= text_field_tag "flow_element_sizing[downstream_minimum][1][total_system_dp]", "", :id => "dmin_discharge_total_system_dp_1", :class => "pressure_general" %></td>
          <td><%= text_field_tag "flow_element_sizing[downstream_minimum][1][pressure_at_outlet_flange]", "", :id => "dmin_discharge_pressure_at_outlet_flange_1", :class => "pressure_differential" %></td>
          <td><%= link_to "X", "#", :class => "downstream_minimum_table_close_tr", :downstream_minimum_id => "0", :row_id => "1" %></td>
        </tr>
      <% end %>
    </table>

    <%= link_to "Add More", "#", :id => "add_new_downstream_minimum_row", :class => "add_new_downstream_row" %>

    <table class="hidden" id="new_downstream_minimum_row">
      <tr>
        <td>
          <b>#x#</b>
          <%= hidden_field_tag "flow_element_sizing[downstream_minimum][#x#][id]", "", :id => "dmin_discharges_id_#x#" %>
          <%= hidden_field_tag "flow_element_sizing[downstream_minimum][#x#][path]", "#x#", :id => "dmin_path_#x#" %>
          <%= hidden_field_tag "flow_element_sizing[downstream_minimum][#x#][downstream_condition_basis]", "minimum" %>
        </td>
        <td>
          <%= radio_button_tag "design_circuit", '#x#', false, :id => "dnor_design_circuit_#x#" %>
          <%= hidden_field_tag "flow_element_sizing[downstream_minimum][#x#][design_circuit]", "", :id => "dmin_discharge_design_circuit_#x#" %>
        </td>
        <td><%= select_tag "flow_element_sizing[downstream_minimum][#x#][process_basis_id]", options_for_select(@company.heat_and_material_balances.collect { |p| [p[:case], p[:id]] }.insert(0, '')), {:id => "dmin_discharge_process_basis_id_#x#", :style => "width:100px;", :row_id => "#x#"} %></td>
        <td><%= select_tag "flow_element_sizing[downstream_minimum][#x#][destination_stream_no]", options_for_select(@streams.collect { |p| [p[:stream_no], p[:display_stream_no]] }.insert(0, '')), :id => "dmin_discharge_destination_stream_no_#x#", :style => "width:100px;", :row_id => "#x#" %></td>
        <td><input type="button" value="Circuit Piping" class="circuit_piping_btn" row_id="#x#"></td>
        <td><%= text_field_tag "flow_element_sizing[downstream_minimum][#x#][destination_pressure]", "", :id => "dmin_discharge_destination_pressure_#x#", :class => "pressure_general" %></td>
        <td><%= text_field_tag "flow_element_sizing[downstream_minimum][#x#][fitting_dp]", "", :id => "dmin_discharge_fitting_dp_#x#", :class => "pressure_differential" %></td>
        <td><%= text_field_tag "flow_element_sizing[downstream_minimum][#x#][equipment_dp]", "", :id => "dmin_discharge_equipment_dp_#x#", :class => "pressure_differential" %></td>
        <td><%= text_field_tag "flow_element_sizing[downstream_minimum][#x#][control_valve_dp]", "", :id => "dmin_discharge_control_valve_dp_#x#", :class => "pressure_differential" %></td>
        <td><%= text_field_tag "flow_element_sizing[downstream_minimum][#x#][orifice_dp]", "", :id => "dmin_discharge_orifice_dp_#x#", :class => "pressure_differential" %></td>
        <td><%= text_field_tag "flow_element_sizing[downstream_minimum][#x#][total_system_dp]", "", :id => "dmin_discharge_total_system_dp_#x#", :class => "pressure_general" %></td>
        <td><%= text_field_tag "flow_element_sizing[downstream_minimum][#x#][pressure_at_outlet_flange]", "", :id => "dmin_discharge_pressure_at_outlet_flange_#x#", :class => "pressure_differential" %></td>
        <td><%= link_to "X", "#", :class => "downstream_normal_table_close_tr", :downstream_minimum_id => "0", :row_id => "#x#" %></td>
      </tr>
    </table>
  </div>
  <br>
  <%= f.submit 'Save' if !flow_element_sizing.new_record? %>
  <input type='button' value='Calculate' id='downstream_calculate'>
  </div>
  <div id="tab3" class="tab_content">
    <!-- Orifice Design -->
    <table>
      <tr>
        <td colspan="4"><b><u>MECHANICAL DETAILS</u></b></td>
      </tr>
      <tr>
        <td>Manufacturer</td>
        <td><%= f.text_field :os_manufacturer %></td>
        <td>Restriction Type</td>
        <td><%= f.select :os_restriction_type, options_for_select(@restriction_type, flow_element_sizing.os_restriction_type), :include_blank => true %></td>
      </tr>
      <tr>
        <td>Model</td>
        <td><%= f.text_field :os_model %></td>
        <td>Orifice Type</td>
        <td><%= f.select :os_orifice_type, options_for_select(@orifice_type, flow_element_sizing.os_orifice_type), :include_blank => true %></td>
      </tr>
      <tr>
        <td>Pipe Size</td>
        <td><%= f.select :os_pipe_size, options_for_select(PipeSizing.pipe_sizes.collect { |p| [raw(p[:name]), p[:value]] }, flow_element_sizing.os_pipe_size), :include_blank => true %>&nbsp;</td>
        <td>Pipe ID</td>
        <td>
          <label id="os_pipe_id"><%= flow_element_sizing.os_pipe_id %></label>&nbsp;<label class="length_small_dimension_length_unit"> </label>
        </td>
      </tr>
      <tr>
        <td>Pipe Schedule</td>
        <td><%= f.select :os_pipe_schedule, options_for_select(PipeSizing.pipe_schedules.collect { |p| [raw(p[:name]), p[:name]] }, flow_element_sizing.os_pipe_schedule), :include_blank => true %></td>
        <td>Orifice Diameter</td>
        <td><%= f.text_field :os_orifice_diameter, :class => "length_small_dimension_length" %>&nbsp;<label class="length_small_dimension_length_unit"></label>
        </td>
      </tr>
      <tr>
        <td colspan="4" style="text-align:right;"><input type="button" id='orifice_design' value="Design"></td>
      </tr>
      <tr>
        <td><b><u>RESULTS</u></b></td>
        <td><b><u>Minimum</u></b></td>
        <td><b><u>Normal</u></b></td>
        <td><b><u>Maximum</u></b></td>
      </tr>
      <tr>
        <td>Differential Pressure</td>
        <td><%= flow_element_sizing.os_min_differential_pressure %>&nbsp;<label class="pressure_differential_unit"></label>
        </td>
        <td><%= flow_element_sizing.os_nor_differential_pressure %>&nbsp;<label class="pressure_differential_unit"></label>
        </td>
        <td><%= flow_element_sizing.os_max_differential_pressure %>&nbsp;<label class="pressure_differential_unit"></label>
        </td>
      </tr>
      <tr>
        <td>Pipe Reynolds Number</td>
        <td><%= flow_element_sizing.os_min_pipe_reynolds_number %></td>
        <td><%= flow_element_sizing.os_nor_pipe_reynolds_number %></td>
        <td><%= flow_element_sizing.os_max_pipe_reynolds_number %></td>
      </tr>
      <tr>
        <td>Orifice Reynolds Number</td>
        <td><%= flow_element_sizing.os_min_orifice_reynolds_number %></td>
        <td><%= flow_element_sizing.os_nor_orifice_reynolds_number %></td>
        <td><%= flow_element_sizing.os_max_orifice_reynolds_number %></td>
      </tr>
      <tr>
        <td>Beta, B</td>
        <td><%= flow_element_sizing.os_min_beta_b %></td>
        <td><%= flow_element_sizing.os_nor_beta_b %></td>
        <td><%= flow_element_sizing.os_max_beta_b %></td>
      </tr>
      <tr>
        <td>Orifice Coefficient, Co</td>
        <td><%= flow_element_sizing.os_min_orifice_coefficient_co %></td>
        <td><%= flow_element_sizing.os_nor_orifice_coefficient_co %></td>
        <td><%= flow_element_sizing.os_max_orifice_coefficient_co %></td>
      </tr>
      <tr>
        <td>Orifice Diameter, d</td>
        <td><%= flow_element_sizing.os_min_orifice_diameter_d %>&nbsp;<label class="length_small_dimension_length_unit"></label>
        </td>
        <td><%= flow_element_sizing.os_nor_orifice_diameter_d %>&nbsp;<label class="length_small_dimension_length_unit"></label>
        </td>
        <td><%= flow_element_sizing.os_max_orifice_diameter_d %>&nbsp;<label class="length_small_dimension_length_unit"></label>
        </td>
      </tr>
      <tr>
        <td>Orifice Range(%)</td>
        <td><%= f.text_field :os_min_orifice_range %></td>
        <td><%= f.text_field :os_min_orifice_range %></td>
        <td><%= f.text_field :os_min_orifice_range %></td>
      </tr>
      <tr>
        <td colspan="4"><b><u>NOTES</u></b></td>
      </tr>
      <tr>
        <td colspan="4"><%= f.text_area :os_notes, :size => "150x4" %></td>
      </tr>
    </table>
  </div>
  </div>
  <div class="clear"></div>
  </div>

  <!-- PIPING -->
  <div style="display:none;">
    <div id="piping_box">
      <div id="upstream_condition_basis" style=""></div>
      <table id="piping_table">
        <tr>
          <th rowspan="2">No.</th>
          <th rowspan="2">Fitting(s)</th>
          <th rowspan="2">Fitting Tag</th>
          <th>Pipe Size</th>
          <th rowspan="2">Pipe Sch.</th>
          <th>Pipe ID</th>
          <th rowspan="2">% Flow</th>
          <th rowspan="2">Ds/Dl<br>or Cv</th>
          <th>Length</th>
          <th>Elev.</th>
          <th class="delta_p_maximum">&Delta;P</th>
          <th class="delta_p_normal">&Delta;P</th>
          <th class="delta_p_minimum">&Delta;P</th>
          <th>Outlet Pressure</th>
          <th rowspan="2"></th>
        </tr>
        <tr>
          <th>inches</th>
          <th><label class="length_pipe_tube_diameter_unit"></label></th>
          <th><label class="length_large_dimension_length_unit"></label></th>
          <th><label class="length_large_dimension_length_unit"></label></th>
          <th class="delta_p_maximum"><label class="pressure_differential_unit"></label></th>
          <th class="delta_p_normal"><label class="pressure_differential_unit"></label></th>
          <th class="delta_p_minimum"><label class="pressure_differential_unit"></label></th>
          <th><label class="pressure_general_unit"></label></th>
        </tr>
        <% flow_element_sizing.suction_pipings.where(:tab => "upstream").each_with_index do |sp, i| %>
          <tr>
            <td>
              <%= i+1 %>
              <%= hidden_field_tag "flow_element_sizing[suction_pipings][#{i+1}][id]", sp.id, :id => "suction_pipings_id_#{i+1}" %>
              <%= hidden_field_tag "flow_element_sizing[suction_pipings][#{i+1}][tab]", "upstream", :id => "suction_pipings_tab_#{i+1}" %>
            </td>
            <td><%= select_tag "flow_element_sizing[suction_pipings][#{i+1}][fitting]", options_for_select(PipeSizing.fitting.collect { |p| [raw(p[:value]), p[:id]] }.insert(0, ''), sp.fitting), :id => "suction_pipings_fitting_#{i+1}", :style => "width:150px;" %></td>
            <td><%= text_field_tag "flow_element_sizing[suction_pipings][#{i+1}][fitting_tag]", sp.fitting_tag, :id => "suction_pipings_fitting_tag_#{i+1}" %></td>
            <td><%= select_tag "flow_element_sizing[suction_pipings][#{i+1}][pipe_size]", options_for_select(PipeSizing.pipe_sizes.collect { |p| [raw(p[:name]), p[:value]] }.insert(0, ''), sp.pipe_size), :id => "suction_pipings_pipe_size_#{i+1}", :class => "suction_pipings_pipe_size", :row_id => "#{i+1}", :class => "suction_pipings_pipe_size", :row_id => "#{i+1}" %></td>
            <td><%= select_tag "flow_element_sizing[suction_pipings][#{i+1}][pipe_schedule]", options_for_select(PipeSizing.pipe_size_schedules[sp.pipe_size.to_s], sp.pipe_schedule), :id => "suction_pipings_pipe_schedule_#{i+1}", :class => "suction_pipings_pipe_schedule", :row_id => "#{i+1}", :class => "suction_pipings_pipe_schedule", :row_id => "#{i+1}" %></td>
            <td><%= text_field_tag "flow_element_sizing[suction_pipings][#{i+1}][pipe_id]", sp.pipe_id, :id => "suction_pipings_pipe_id_#{i+1}", :class => "length_pipe_tube_diameter" %></td>
            <td><%= text_field_tag "flow_element_sizing[suction_pipings][#{i+1}][per_flow]", sp.per_flow, :id => "suction_pipings_per_flow_#{i+1}" %></td>
            <td><%= text_field_tag "flow_element_sizing[suction_pipings][#{i+1}][ds_cv]", sp.ds_cv, :id => "suction_pipings_ds_cv_#{i+1}" %></td>
            <td><%= text_field_tag "flow_element_sizing[suction_pipings][#{i+1}][length]", sp.length, :id => "suction_pipings_length_#{i+1}", :class => "length_large_dimension_length" %></td>
            <td><%= text_field_tag "flow_element_sizing[suction_pipings][#{i+1}][elev]", sp.elev, :id => "suction_pipings_elev_#{i+1}", :class => "length_large_dimension_length" %></td>
            <td class="delta_p_maximum"><%= text_field_tag "flow_element_sizing[suction_pipings][#{i+1}][delta_p_max]", sp.delta_p_max, :id => "suction_pipings_delta_p_max_#{i+1}", :class => "pressure_differential" %></td>
            <td class="delta_p_normal"><%= text_field_tag "flow_element_sizing[suction_pipings][#{i+1}][delta_p_nor]", sp.delta_p_nor, :id => "suction_pipings_delta_p_nor_#{i+1}", :class => "pressure_differential" %></td>
            <td class="delta_p_minimum"><%= text_field_tag "flow_element_sizing[suction_pipings][#{i+1}][delta_p_min]", sp.delta_p_min, :id => "suction_pipings_delta_p_min_#{i+1}", :class => "pressure_differential" %></td>
            <td><%= text_field_tag "flow_element_sizing[suction_pipings][#{i+1}][outlet_pressure]", sp.outlet_pressure, :id => "suction_pipings_outlet_pressure_#{i+1}", :class => "pressure_general" %></td>
            <td><%= link_to "X", "#", :class => "suction_piping_close_tr", :suction_piping_id => "#{i+1}" %></td>
          </tr>
        <% end %>
        <% if flow_element_sizing.suction_pipings.where(:tab => "upstream").empty? %>
          <tr>
            <td>
              1
              <%= hidden_field_tag "flow_element_sizing[suction_pipings][1][id]", "", :id => "suction_pipings_id_1" %>
              <%= hidden_field_tag "flow_element_sizing[suction_pipings][1][tab]", "upstream", :id => "suction_pipings_tab_1" %>
            </td>
            <td><%= select_tag "flow_element_sizing[suction_pipings][1][fitting]", options_for_select(PipeSizing.fitting.collect { |p| [raw(p[:value]), p[:id]] }.insert(0, '')), :id => "suction_pipings_fitting_1", :style => "width:150px;" %></td>
            <td><%= text_field_tag "flow_element_sizing[suction_pipings][1][fitting_tag]", "", :id => "suction_pipings_fitting_tag_1" %></td>
            <td><%= select_tag "flow_element_sizing[suction_pipings][1][pipe_size]", options_for_select(PipeSizing.pipe_sizes.collect { |p| [raw(p[:name]), p[:value]] }.insert(0, '')), :id => "suction_pipings_pipe_size_1", :class => "suction_pipings_pipe_size", :row_id => "1" %></td>
            <td><%= select_tag "flow_element_sizing[suction_pipings][1][pipe_schedule]", options_for_select([]), :id => "suction_pipings_pipe_schedule_1", :class => "suction_pipings_pipe_schedule", :row_id => "1" %></td>
            <td><%= text_field_tag "flow_element_sizing[suction_pipings][1][pipe_id]", "", :id => "suction_pipings_pipe_id_1", :class => "length_pipe_tube_diameter" %></td>
            <td><%= text_field_tag "flow_element_sizing[suction_pipings][1][per_flow]", "", :id => "suction_pipings_per_flow_1" %></td>
            <td><%= text_field_tag "flow_element_sizing[suction_pipings][1][ds_cv]", "", :id => "suction_pipings_ds_cv_1" %></td>
            <td><%= text_field_tag "flow_element_sizing[suction_pipings][1][length]", "", :id => "suction_pipings_length_1", :class => "length_large_dimension_length" %></td>
            <td><%= text_field_tag "flow_element_sizing[suction_pipings][1][elev]", "", :id => "suction_pipings_elev_1", :class => "length_large_dimension_length" %></td>
            <td class="delta_p_maximum"><%= text_field_tag "flow_element_sizing[suction_pipings][1][delta_p_max]", "", :id => "suction_pipings_delta_p_max_1", :class => "pressure_differential" %></td>
            <td class="delta_p_normal"><%= text_field_tag "flow_element_sizing[suction_pipings][1][delta_p_nor]", "", :id => "suction_pipings_delta_p_nor_1", :class => "pressure_differential" %></td>
            <td class="delta_p_minimum"><%= text_field_tag "flow_element_sizing[suction_pipings][1][delta_p_min]", "", :id => "suction_pipings_delta_p_min_1", :class => "pressure_differential" %></td>
            <td><%= text_field_tag "flow_element_sizing[suction_pipings][1][outlet_pressure]", "", :id => "suction_pipings_outlet_pressure_1", :class => "pressure_general" %></td>
            <td><%= link_to "X", "#", :class => "suction_piping_close_tr", :suction_piping_id => 1 %></td>
          </tr>
        <% end %>
      </table>
      <br>
      <%= link_to "Add", "#", :id => "add_new_suction_piping" %>&nbsp;|&nbsp;<%= link_to "Close", "#", :id => "close_suction_piping" %>
      <!-- new piping tr-->
      <table id="new_piping_tr" class="hidden">
        <tr>
          <td>
            #x#
            <%= hidden_field_tag "flow_element_sizing[suction_pipings][#x#][id]", "", :id => "suction_pipings_id_#x#" %>
            <%= hidden_field_tag "flow_element_sizing[suction_pipings][#x#][tab]", "upstream", :id => "suction_pipings_tab_#x#" %>
          </td>
          <td><%= select_tag "flow_element_sizing[suction_pipings][#x#][fitting]", options_for_select(PipeSizing.fitting.collect { |p| [raw(p[:value]), p[:id]] }.insert(0, '')), :id => "suction_pipings_fitting_#x#", :style => "width:150px;" %></td>
          <td><%= text_field_tag "flow_element_sizing[suction_pipings][#x#][fitting_tag]", "", :id => "suction_pipings_fitting_tag_#x#" %></td>
          <td><%= select_tag "flow_element_sizing[suction_pipings][#x#][pipe_size]", options_for_select(PipeSizing.pipe_sizes.collect { |p| [raw(p[:name]), p[:value]] }.insert(0, '')), :id => "suction_pipings_pipe_size_#x#", :class => "suction_pipings_pipe_size", :row_id => "#x#" %></td>
          <td><%= select_tag "flow_element_sizing[suction_pipings][#x#][pipe_schedule]", options_for_select([]), :id => "suction_pipings_pipe_schedule_#x#", :class => "suction_pipings_pipe_schedule", :row_id => "#x#" %></td>
          <td><%= text_field_tag "flow_element_sizing[suction_pipings][#x#][pipe_id]", "", :id => "suction_pipings_pipe_id_#x#", :class => "length_pipe_tube_diameter" %></td>
          <td><%= text_field_tag "flow_element_sizing[suction_pipings][#x#][per_flow]", "", :id => "suction_pipings_per_flow_#x#" %></td>
          <td><%= text_field_tag "flow_element_sizing[suction_pipings][#x#][ds_cv]", "", :id => "suction_pipings_ds_cv_#x#" %></td>
          <td><%= text_field_tag "flow_element_sizing[suction_pipings][#x#][length]", "", :id => "suction_pipings_length_#x#", :class => "length_large_dimension_length" %></td>
          <td><%= text_field_tag "flow_element_sizing[suction_pipings][#x#][elev]", "", :id => "suction_pipings_elev_#x#", :class => "length_large_dimension_length" %></td>
          <td class="delta_p_maximum"><%= text_field_tag "flow_element_sizing[suction_pipings][#x#][delta_p_max]", "", :id => "suction_pipings_delta_p_max_#x#", :class => "pressure_differential" %></td>
          <td class="delta_p_normal"><%= text_field_tag "flow_element_sizing[suction_pipings][#x#][delta_p_nor]", "", :id => "suction_pipings_delta_p_nor_#x#", :class => "pressure_differential" %></td>
          <td class="delta_p_minimum"><%= text_field_tag "flow_element_sizing[suction_pipings][#x#][delta_p_min]", "", :id => "suction_pipings_delta_p_min_#x#", :class => "pressure_differential" %></td>
          <td><%= text_field_tag "flow_element_sizing[suction_pipings][#x#][outlet_pressure]", "", :id => "suction_pipings_outlet_pressure_#x#", :class => "pressure_general" %></td>
          <td><%= link_to "X", "#", :class => "suction_piping_close_tr", :suction_piping_id => 0 %></td>
        </tr>
      </table>
    </div>
  </div>

  <!-- DOWNSTREAM CIRCUIT PIPING -->
  <div style="display:none;" id="downstream_circuit_piping_div">
    <div id="downstream_circuit_piping_box_#x#">
      <div class="downstream_condition_basis" style="font-size:16px;"></div>
      <table class="downstream_circuit_piping_table">
        <tr>
          <th rowspan="2">No.</th>
          <th rowspan="2">Fitting(s)</th>
          <th rowspan="2">Fitting Tag</th>
          <th>Pipe Size</th>
          <th rowspan="2">Pipe Sch.</th>
          <th>Pipe ID</th>
          <th rowspan="2">% Flow</th>
          <th rowspan="2">Ds/Dl<br>or Cv</th>
          <th>Length</th>
          <th>Elev.</th>
          <th class="downstream_delta_p_maximum">&Delta;P</th>
          <th class="downstream_delta_p_normal">&Delta;P</th>
          <th class="downstream_delta_p_minimum">&Delta;P</th>
          <th>Inlet Pressure</th>
          <th rowspan="2"></th>
        </tr>
        <tr>
          <th>inches</th>
          <th><label class="length_pipe_tube_diameter_unit"></label></th>
          <th><label class="length_large_dimension_length_unit"></label></th>
          <th><label class="length_large_dimension_length_unit"></label></th>
          <th class="downstream_delta_p_maximum"><label class="pressure_differential_unit"></label></th>
          <th class="downstream_delta_p_normal"><label class="pressure_differential_unit"></label></th>
          <th class="downstream_delta_p_minimum"><label class="pressure_differential_unit"></label></th>
          <th><label class="pressure_general_unit"></label></th>
        </tr>
        <tr>
          <td>
            1
            <%= hidden_field_tag "flow_element_sizing[downstream_maximum][#x#][downstream_circuit_pipings][1][id]", "", :id => "downstream_circuit_piping_id_1" %>
          </td>
          <td><%= select_tag "flow_element_sizing[downstream_maximum][#x#][downstream_circuit_pipings][1][fitting]", options_for_select(PipeSizing.fitting.collect { |p| [raw(p[:value]), p[:id]] }.insert(0, '')), :id => "downstream_circuit_piping_fitting_1", :style => "width:200px;" %></td>
          <td><%= text_field_tag "flow_element_sizing[downstream_maximum][#x#][downstream_circuit_pipings][1][fitting_tag]", "", :id => "downstream_circuit_piping_fitting_tag_1" %></td>
          <td><%= select_tag "flow_element_sizing[downstream_maximum][#x#][downstream_circuit_pipings][1][pipe_size]", options_for_select(PipeSizing.pipe_sizes.collect { |p| [raw(p[:name]), p[:value]] }.insert(0, '')), :id => "downstream_circuit_piping_pipe_size_1", :class => "downstream_circuit_piping_pipe_size", :row_id => "1" %></td>
          <td><%= select_tag "flow_element_sizing[downstream_maximum][#x#][downstream_circuit_pipings][1][pipe_schedule]", options_for_select([]), :id => "downstream_circuit_piping_pipe_schedule_1", :class => "downstream_circuit_piping_pipe_schedule", :row_id => "1" %></td>
          <td><%= text_field_tag "flow_element_sizing[downstream_maximum][#x#][downstream_circuit_pipings][1][pipe_id]", "", :id => "downstream_circuit_piping_pipe_id_1", :class => "length_pipe_tube_diameter", :row_id => "1" %></td>
          <td><%= text_field_tag "flow_element_sizing[downstream_maximum][#x#][downstream_circuit_pipings][1][elev]", "", :id => "downstream_circuit_piping_elev_1", :row_id => "1" %></td>
          <td><%= text_field_tag "flow_element_sizing[downstream_maximum][#x#][downstream_circuit_pipings][1][per_flow]", "", :id => "downstream_circuit_piping_per_flow_1" %></td>
          <td><%= text_field_tag "flow_element_sizing[downstream_maximum][#x#][downstream_circuit_pipings][1][ds_cv]", "", :id => "downstream_circuit_piping_ds_cv_1", :class => "length_large_dimension_length" %></td>
          <td><%= text_field_tag "flow_element_sizing[downstream_maximum][#x#][downstream_circuit_pipings][1][length]", "", :id => "downstream_circuit_piping_length_1", :class => "length_large_dimension_length", :row_id => "1" %></td>
          <td class="downstream_delta_p_maximum"><%= text_field_tag "flow_element_sizing[downstream_maximum][#x#][downstream_circuit_pipings][1][delta_p_max]", "", :id => "downstream_circuit_piping_delta_p_max_1", :class => "pressure_differential", :row_id => "1" %></td>
          <td class="downstream_delta_p_normal"><%= text_field_tag "flow_element_sizing[downstream_maximum][#x#][downstream_circuit_pipings][1][delta_p_nor]", "", :id => "downstream_circuit_piping_delta_p_nor_1", :class => "pressure_differential", :row_id => "1" %></td>
          <td class="downstream_delta_p_minimum"><%= text_field_tag "flow_element_sizing[downstream_maximum][#x#][downstream_circuit_pipings][1][delta_p_min]", "", :id => "downstream_circuit_piping_delta_p_min_1", :class => "pressure_differential", :row_id => "1" %></td>
          <td><%= label_tag "inlet_pressure", "", :class => "pressure_general" %></td>
          <td><%= link_to "X", "#", :class => "downstream_circuit_piping_close_tr", :row_id => 1 %></td>
        </tr>
      </table>

      <%= link_to "Add More", "#", :class => "downstream_circuit_piping_add_more", :table_id => "#x#" %>&nbsp;|&nbsp;<%= link_to "Close", "#", :class => "downstream_circuit_piping_close" %>
    </div>
  </div>

  <table id="downstream_circuit_pipings_tr" class="hidden">
    <tr>
      <td>
        #y#
        <%= hidden_field_tag "flow_element_sizing[downstream_maximum][#x#][downstream_circuit_pipings][#y#][id]", "", :id => "downstream_circuit_piping_id_#y#" %>
      </td>
      <td><%= select_tag "flow_element_sizing[downstream_maximum][#x#][downstream_circuit_pipings][#y#][fitting]", options_for_select(PipeSizing.fitting.collect { |p| [raw(p[:value]), p[:id]] }.insert(0, '')), :id => "downstream_circuit_piping_fitting_#y#", :style => "width:200px;" %></td>
      <td><%= text_field_tag "flow_element_sizing[downstream_maximum][#x#][downstream_circuit_pipings][#y#][fitting_tag]", "", :id => "downstream_circuit_piping_fitting_tag_#y#" %></td>
      <td><%= select_tag "flow_element_sizing[downstream_maximum][#x#][downstream_circuit_pipings][#y#][pipe_size]", options_for_select(PipeSizing.pipe_sizes.collect { |p| [raw(p[:name]), p[:value]] }.insert(0, '')), :id => "downstream_circuit_piping_pipe_size_#y#", :class => "downstream_circuit_piping_pipe_size", :row_id => "#y#" %></td>
      <td><%= select_tag "flow_element_sizing[downstream_maximum][#x#][downstream_circuit_pipings][#y#][pipe_schedule]", options_for_select([]), :id => "downstream_circuit_piping_pipe_schedule_#y#", :class => "downstream_circuit_piping_pipe_schedule", :row_id => "#y#" %></td>
      <td><%= text_field_tag "flow_element_sizing[downstream_maximum][#x#][downstream_circuit_pipings][#y#][pipe_id]", "", :id => "downstream_circuit_piping_pipe_id_#y#", :class => "length_pipe_tube_diameter", :row_id => "#y#" %></td>
      <td><%= text_field_tag "flow_element_sizing[downstream_maximum][#x#][downstream_circuit_pipings][#y#][per_flow]", "", :id => "downstream_circuit_piping_per_flow_#y#" %></td>
      <td><%= text_field_tag "flow_element_sizing[downstream_maximum][#x#][downstream_circuit_pipings][#y#][ds_cv]", "", :id => "downstream_circuit_piping_ds_cv_#y#" %></td>
      <td><%= text_field_tag "flow_element_sizing[downstream_maximum][#x#][downstream_circuit_pipings][#y#][length]", "", :id => "downstream_circuit_piping_length_#y#", :class => "length_large_dimension_length", :row_id => "#y#" %></td>
      <td><%= text_field_tag "flow_element_sizing[downstream_maximum][#x#][downstream_circuit_pipings][#y#][elev]", "", :id => "downstream_circuit_piping_elev_#y#", :class => "length_large_dimension_length", :row_id => "#y#" %></td>
      <td class="downstream_delta_p_maximum"><%= text_field_tag "flow_element_sizing[downstream_maximum][#x#][downstream_circuit_pipings][#y#][delta_p_max]", "", :id => "downstream_circuit_piping_delta_p_max_#y#", :class => "pressure_differential", :row_id => "#y#" %></td>
      <td class="downstream_delta_p_normal"><%= text_field_tag "flow_element_sizing[downstream_maximum][#x#][downstream_circuit_pipings][#y#][delta_p_nor]", "", :id => "downstream_circuit_piping_delta_p_nor_#y#", :class => "pressure_differential", :row_id => "#y#" %></td>
      <td class="downstream_delta_p_minimum"><%= text_field_tag "flow_element_sizing[downstream_maximum][#x#][downstream_circuit_pipings][#y#][delta_p_min]", "", :id => "downstream_circuit_piping_delta_p_min_#y#", :class => "pressure_differential", :row_id => "#y#" %></td>
      <td><%= label_tag "inlet_pressure", "", :class => "pressure_general" %></td>
      <td><%= link_to "X", "#", :class => "downstream_circuit_piping_close_tr", :row_id => 1 %></td>
    </tr>
  </table>

  <!-- list of discharge circuit piping -->
  <div id="list_of_downstream_circuit_piping" class="hidden">
    <% flow_element_sizing.flow_element_downstreams.where(:downstream_condition_basis => "maximum").each_with_index do |cvd, i| %>
      <% cvd_row_id = i+1 %>
      <% if cvd.downstream_circuit_pipings.empty? %>
        <% next %>
      <% end %>
      <div id="downstream_circuit_piping_box_<%= cvd_row_id %>">
        <div class="downstream_condition_basis" style="font-size:16px;"></div>
        <table class="downstream_circuit_piping_table">
          <tr>
            <th rowspan="2">No.</th>
            <th rowspan="2">Fitting(s)</th>
            <th rowspan="2">Fitting Tag</th>
            <th>Pipe Size</th>
            <th rowspan="2">Pipe Sch.</th>
            <th>Pipe ID</th>
            <th rowspan="2">% Flow</th>
            <th rowspan="2">Ds/Dl<br>or Cv</th>
            <th>Length</th>
            <th>Elev.</th>
            <th class="downstream_delta_p_maximum">&Delta;P</th>
            <th class="downstream_delta_p_normal">&Delta;P</th>
            <th class="downstream_delta_p_minimum">&Delta;P</th>
            <th>Inlet Pressure</th>
            <th rowspan="2"></th>
          </tr>
          <tr>
            <th>inches</th>
            <th><label class="length_pipe_tube_diameter_unit"></label></th>
            <th><label class="length_large_dimension_length_unit"></label></th>
            <th><label class="length_large_dimension_length_unit"></label></th>
            <th class="downstream_delta_p_maximum"><label class="pressure_differential_unit"></label></th>
            <th class="downstream_delta_p_normal"><label class="pressure_differential_unit"></label></th>
            <th class="downstream_delta_p_minimum"><label class="pressure_differential_unit"></label></th>
            <th><label class="pressure_general_unit"></label></th>
          </tr>
          <% cvd.downstream_circuit_pipings.each_with_index do |dcp, j| %>
            <tr>
              <td>
                <%= j+1 %>
                <%= hidden_field_tag "flow_element_sizing[downstream_maximum][#{cvd_row_id}][downstream_circuit_pipings][#{j+1}][id]", dcp.id, :id => "downstream_circuit_piping_id_#{j+1}" %>
              </td>
              <td><%= select_tag "flow_element_sizing[downstream_maximum][#{cvd_row_id}][downstream_circuit_pipings][#{j+1}][fitting]", options_for_select(PipeSizing.fitting.collect { |p| [raw(p[:value]), p[:id]] }.insert(0, ''), dcp.fitting), :id => "downstream_circuit_piping_fitting_#{j+1}", :style => "width:200px;" %></td>
              <td><%= text_field_tag "flow_element_sizing[downstream_maximum][#{cvd_row_id}][downstream_circuit_pipings][#{j+1}][fitting_tag]", dcp.fitting_tag, :id => "downstream_circuit_piping_fitting_tag_#{j+1}" %></td>
              <td><%= select_tag "flow_element_sizing[downstream_maximum][#{cvd_row_id}][downstream_circuit_pipings][#{j+1}][pipe_size]", options_for_select(PipeSizing.pipe_sizes.collect { |p| [raw(p[:name]), p[:value]] }.insert(0, ''), dcp.pipe_size), :id => "downstream_circuit_piping_pipe_size_#{j+1}", :class => "downstream_circuit_piping_pipe_size", :row_id => "#{j+1}" %></td>
              <td><%= select_tag "flow_element_sizing[downstream_maximum][#{cvd_row_id}][downstream_circuit_pipings][#{j+1}][pipe_schedule]", options_for_select(PipeSizing.pipe_size_schedules[dcp.pipe_size.to_s], dcp.pipe_schedule), :id => "downstream_circuit_piping_pipe_schedule_#{j+1}", :class => "downstream_circuit_piping_pipe_schedule", :row_id => "#{j+1}" %></td>
              <td><%= text_field_tag "flow_element_sizing[downstream_maximum][#{cvd_row_id}][downstream_circuit_pipings][#{j+1}][pipe_id]", dcp.pipe_id, :id => "downstream_circuit_piping_pipe_id_#{j+1}", :class => "length_pipe_tube_diameter", :row_id => "#{j+1}" %></td>
              <td><%= text_field_tag "flow_element_sizing[downstream_maximum][#{cvd_row_id}][downstream_circuit_pipings][#{j+1}][per_flow]", dcp.per_flow, :id => "downstream_circuit_piping_per_flow_#{j+1}" %></td>
              <td><%= text_field_tag "flow_element_sizing[downstream_maximum][#{cvd_row_id}][downstream_circuit_pipings][#{j+1}][ds_cv]", dcp.ds_cv, :id => "downstream_circuit_piping_ds_cv_#{j+1}" %></td>
              <td><%= text_field_tag "flow_element_sizing[downstream_maximum][#{cvd_row_id}][downstream_circuit_pipings][#{j+1}][length]", dcp.length, :id => "downstream_circuit_piping_length_#{j+1}", :class => "length_large_dimension_length", :row_id => "#{j+1}" %></td>
              <td><%= text_field_tag "flow_element_sizing[downstream_maximum][#{cvd_row_id}][downstream_circuit_pipings][#{j+1}][elev]", dcp.elev, :id => "downstream_circuit_piping_elev_#{j+1}", :class => "length_large_dimension_length", :row_id => "#{j+1}" %></td>
              <td class="downstream_delta_p_maximum"><%= text_field_tag "flow_element_sizing[downstream_maximum][#{cvd_row_id}][downstream_circuit_pipings][#{j+1}][delta_p_max]", dcp.delta_p_max, :id => "downstream_circuit_piping_delta_p_max_#{j+1}", :class => "pressure_differential", :row_id => "#{j+1}" %></td>
              <td class="downstream_delta_p_normal"><%= text_field_tag "flow_element_sizing[downstream_maximum][#{cvd_row_id}][downstream_circuit_pipings][#{j+1}][delta_p_nor]", dcp.delta_p_nor, :id => "downstream_circuit_piping_delta_p_nor_#{j+1}", :class => "pressure_differential", :row_id => "#{j+1}" %></td>
              <td class="downstream_delta_p_minimum"><%= text_field_tag "flow_element_sizing[downstream_maximum][#{cvd_row_id}][downstream_circuit_pipings][#{j+1}][delta_p_max]", dcp.delta_p_max, :id => "downstream_circuit_piping_delta_p_min_#{j+1}", :class => "pressure_differential", :row_id => "#{j+1}" %></td>
              <td><%= label_tag "inlet_pressure", "", :class => "pressure_general" %></td>
              <td><%= link_to "X", "#", :class => "downstream_circuit_piping_close_tr", :row_id => "#{j+1}" %></td>
            </tr>
          <% end %>
        </table>

        <%= link_to "Add More", "#", :class => "downstream_circuit_piping_add_more", :table_id => "#{cvd_row_id}" %>&nbsp;|&nbsp;<%= link_to "Close", "#", :class => "downstream_circuit_piping_close" %>
      </div>
    <% end %>
  </div>
<% end %>
<% unless flow_element_sizing.new_record? %>
  <fieldset class="project" style="margin-top:15px;">
    <legend>Attachments</legend>
    <%= render :partial => "attachments/attachments", :locals => {:attachments => @attachments} %>
    <%= render :partial => "attachments/form", :locals => {:attachment => @new_attachment} %>
  </fieldset>
  <fieldset class="project" style="margin-top:15px;">
    <legend>Comments</legend>
    <%= render :partial => "comments/comments", :locals => {:comments => @comments} %>
    <%= render :partial => "comments/form", :locals => {:comment => @new_comment} %>
  </fieldset>
<% end %>

<%= javascript_tag do %>
  var flow_element_sizing_id = "<%= flow_element_sizing.id %>";

  var pipe_size_schedules = <%= raw PipeSizing.pipe_size_schedules.to_json %>;
  var pipe_size_pipe_ods = <%= raw PipeSizing.pipe_size_pipe_od.to_json %>;
  var pipe_size_wall_thinkness = <%= raw PipeSizing.pipe_size_wall_thinkness.to_json %>;
  var pipe_id_conversion_factor = <%= @project.conversion_factor("Length", "Pipe Tube Diameter") %>;
  var suction_count = <%= flow_element_sizing.suction_pipings.where(:tab => "upstream").empty? ? 2 : flow_element_sizing.suction_pipings.where(:tab => "upstream").length+1 %>;
  var dmax_count = <%= flow_element_sizing.downstream_maximum.empty? ? 2 : flow_element_sizing.downstream_maximum.length+1 %>

  $('.delta_p_maximum,.delta_p_normal,.delta_p_minimum').hide();
  $('.downstream_delta_p_maximum,.downstream_delta_p_normal,.downstream_delta_p_minimum').hide();

  <% if flow_element_sizing.new_record? %>
  <% else %>
    var upstream_condition_basis = "<%= flow_element_sizing.upstream_condition_basis %>";
    $('.upstream_coditions_table').hide();
    $('#upstream_conditions_'+upstream_condition_basis).show();
    $('#inlet_loss_'+upstream_condition_basis).show();

    var downstream_condition_basis = "<%= flow_element_sizing.downstream_condition_basis %>";
    $('.downstream_tables_div').hide();
    $('#downstream_'+downstream_condition_basis).show();
  <% end %>
<% end %>

<script type="text/javascript">

  set_project_unit_and_decimals();

  $('form.form_flow_element').dirtyForms();

  $("ul.simple-tabs li a").click(function () {
    $('#tab').val($(this).attr('tab'));
  });

  function form_validations() {
    var alert_msg = '';

    if (alert_msg != '') {
      alert(alert_msg);
      return false;
    } else {
      return true;
    }
  }

  $('#flow_element_sizing_upstream_condition_basis').change(function (e) {
    $('.upstream_coditions_table').hide();
    $('#upstream_conditions_' + $(this).val()).show();
    $('#upstream_conditions_' + $(this).val() + ' td').glow('', 2000);
    $('#inlet_loss_' + $(this).val()).show();
    $('#inlet_loss_' + $(this).val() + ' td').glow('', 2000);
  });

  //Upstream
  $('#flow_element_sizing_up_process_basis_id').change(function (e) {
    $('#flow_element_sizing_up_max_stream_no >option, #flow_element_sizing_up_nor_stream_no >option, #flow_element_sizing_up_min_stream_no >option').remove();
    $('#flow_element_sizing_up_max_stream_no,#flow_element_sizing_up_nor_stream_no,#flow_element_sizing_up_min_stream_no').append($('<option></option>').val("").html("Please select"));
    $("#tab1 table input[type=text]").val('');
    if ($(this).val() == "") {
      return false;
    }

    $.get('/admin/heat_and_material_balances/get_stream_nos', {process_basis_id:$(this).val()}, function (data) {
      $(data).each(function (k, v) {
        $('#flow_element_sizing_up_max_stream_no,#flow_element_sizing_up_nor_stream_no,#flow_element_sizing_up_min_stream_no').append(
          $('<option></option>').val(v.stream_no).html(v.display_stream_no)
        );
      });
    }, 'json');
  });

  $('#flow_element_sizing_up_max_stream_no').change(function (e) {
    $("#tab1 #upstream_conditions_maximum input[type=text]").val('');
    if ($(this).val() == "") {
      return false;
    }

    $.get('/admin/flow_element_sizings/get_stream_values',
      {process_basis_id:$('#flow_element_sizing_up_process_basis_id').val(), stream_no:$('#flow_element_sizing_up_max_stream_no').val()},
      function (data) {
        $('#flow_element_sizing_up_max_pressure').val(get_project_field_value1("pressure_general", data['pressure']));
        $('#flow_element_sizing_up_max_temperature').val(get_project_field_value1("temperature_general", data['temperature']));
        $('#flow_element_sizing_up_max_mass_flow_rate').val(get_project_field_value1("mass_flow_rate_general", data['mass_flow_rate']));
        $('#flow_element_sizing_up_max_mass_vapor_fraction').val(get_project_field_value1("mass_vapor_fraction_dimensionless",data['mass_vapour_fraction']));
        $('#flow_element_sizing_up_max_vp_density').val(get_project_field_value1("density_general", data['vp_density']));
        $('#flow_element_sizing_up_max_vp_viscosity').val(get_project_field_value1("viscosity_general", data['vp_viscosity']));
        $('#flow_element_sizing_up_max_lp_density').val(get_project_field_value1("density_general", data['lp_density']));
        $('#flow_element_sizing_up_max_lp_viscosity').val(get_project_field_value1("viscosity_general", data['lp_viscosity']));
      },
      'json');
  });

  $('#flow_element_sizing_up_nor_stream_no').change(function (e) {
    $("#tab1 #upstream_conditions_normal input[type=text]").val('');
    if ($(this).val() == "") {
      return false;
    }

    $.get('/admin/flow_element_sizings/get_stream_values',
      {process_basis_id:$('#flow_element_sizing_up_process_basis_id').val(), stream_no:$('#flow_element_sizing_up_nor_stream_no').val()},
      function (data) {
        $('#flow_element_sizing_up_nor_pressure').val(get_project_field_value1("pressure_general", data['pressure']));
        $('#flow_element_sizing_up_nor_temperature').val(get_project_field_value1("temperature_general", data['temperature']));
        $('#flow_element_sizing_up_nor_mass_flow_rate').val(get_project_field_value1("mass_flow_rate_general", data['mass_flow_rate']));
        $('#flow_element_sizing_up_nor_mass_vapor_fraction').val(get_project_field_value1("mass_vapor_fraction_dimensionless",data['mass_vapour_fraction']));
        $('#flow_element_sizing_up_nor_vp_density').val(get_project_field_value1("density_general", data['vp_density']));
        $('#flow_element_sizing_up_nor_vp_viscosity').val(get_project_field_value1("viscosity_general", data['vp_viscosity']));
        $('#flow_element_sizing_up_nor_lp_density').val(get_project_field_value1("density_general", data['lp_density']));
        $('#flow_element_sizing_up_nor_lp_viscosity').val(get_project_field_value1("viscosity_general", data['lp_viscosity']));
      },
      'json');
  });

  $('#flow_element_sizing_up_min_stream_no').change(function (e) {
    $("#tab1 #upstream_conditions_minimum input[type=text]").val('');
    if ($(this).val() == "") {
      return false;
    }

    $.get('/admin/flow_element_sizings/get_stream_values',
      {process_basis_id:$('#flow_element_sizing_up_process_basis_id').val(), stream_no:$('#flow_element_sizing_up_min_stream_no').val()},
      function (data) {
        $('#flow_element_sizing_up_min_pressure').val(get_project_field_value1("pressure_general", data['pressure']));
        $('#flow_element_sizing_up_min_temperature').val(get_project_field_value1("temperature_general", data['temperature']));
        $('#flow_element_sizing_up_min_mass_flow_rate').val(get_project_field_value1("mass_flow_rate_general", data['mass_flow_rate']));
        $('#flow_element_sizing_up_min_mass_vapor_fraction').val(get_project_field_value1("mass_vapor_fraction_dimensionless",data['mass_vapour_fraction']));
        $('#flow_element_sizing_up_min_vp_density').val(get_project_field_value1("density_general", data['vp_density']));
        $('#flow_element_sizing_up_min_vp_viscosity').val(get_project_field_value1("viscosity_general", data['vp_viscosity']));
        $('#flow_element_sizing_up_min_lp_density').val(get_project_field_value1("density_general", data['lp_density']));
        $('#flow_element_sizing_up_min_lp_viscosity').val(get_project_field_value1("viscosity_general", data['lp_viscosity']));
      },
      'json');
  });

  //Downstream
  $('#flow_element_sizing_downstream_condition_basis').click(function (e) {
    $('.downstream_tables_div').hide();
    $('#downstream_' + $(this).val()).show();
  });

  //maximum
  $('select[id^="dmax_discharge_process_basis_id_"]').live('change', function (e) {
    var row_id = $(this).attr('row_id');
    $('#dmax_discharge_destination_stream_no_' + row_id + ' >option').remove();
    $('#dmax_discharge_destination_stream_no_' + row_id).append($('<option></option>').val("").html(""));
    if ($(this).val() == "") {
      return false;
    }

    $.get('/admin/heat_and_material_balances/get_stream_nos',
      {process_basis_id:$(this).val()},
      function (data) {
        $(data).each(function (k, v) {
          $('#dmax_discharge_destination_stream_no_' + row_id).append(
            $('<option></option>').val(v.stream_no).html(v.display_stream_no)
          );
        });
      },
      'json'
    );
  });

  $('select[id^="dmax_discharge_destination_stream_no_"]').live('change', function (e) {
    var row_id = $(this).attr('row_id');
    $('#dmax_discharge_destination_pressure_' + row_id).val('');
    if ($(this).val() == "") {
      return false;
    }

    $.get('/admin/flow_element_sizings/get_discharge_stream_nos',
      {process_basis_id:$('#dmax_discharge_process_basis_id_' + row_id).val(), stream_no:$(this).val()},
      function (data) {
        $('#dmax_discharge_destination_pressure_' + row_id).val(data['pressure']);
      },
      'json'
    );
  });

  $('.add_new_downstream_row').click(function (e) {
    var new_downstream_maximum_row = $('#new_downstream_maximum_row').html().replace(/#x#/g, dmax_count);
    $('#downstream_maximum_table').append($(new_downstream_maximum_row));

    var new_downstream_normal_row = $('#new_downstream_normal_row').html().replace(/#x#/g, dmax_count);
    $('#downstream_normal_table').append($(new_downstream_normal_row));

    var new_downstream_minimum_row = $('#new_downstream_minimum_row').html().replace(/#x#/g, dmax_count);
    $('#downstream_minimum_table').append($(new_downstream_minimum_row));

    dmax_count++;

    set_project_unit_decimal1('pressure_general')
    set_project_unit_decimal1('pressure_differential')
    return false;
  });

  $('.downstream_maximum_table_close_tr,.downstream_normal_table_close_tr,.downstream_minimum_table_close_tr').live('click', function (e) {
    var row_id = $(this).attr('row_id');
    $('#dmax_discharges_delete_' + row_id).val('true');
    $('#dnor_discharges_delete_' + row_id).val('true');
    $('#dmin_discharges_delete_' + row_id).val('true');
    deleted_tr($('#dmax_discharges_delete_' + row_id).parents('tr'));
    deleted_tr($('#dnor_discharges_delete_' + row_id).parents('tr'));
    deleted_tr($('#dmin_discharges_delete_' + row_id).parents('tr'));
    return false;
  });

  $('#downstream_maximum_table input[name=design_circuit]').live('click', function (e) {
    $("input[id^=dmax_discharge_design_circuit_]").val("");
    $('#dmax_discharge_design_circuit_' + $(this).val()).val(true);
  });

  //normal
  $('select[id^="dnor_discharge_process_basis_id_"]').live('change', function (e) {
    var row_id = $(this).attr('row_id');
    $('#dnor_discharge_destination_stream_no_' + row_id + ' >option').remove();
    $('#dnor_discharge_destination_stream_no_' + row_id).append($('<option></option>').val("").html(""));
    if ($(this).val() == "") {
      return false;
    }

    $.get('/admin/heat_and_material_balances/get_stream_nos',
      {process_basis_id:$(this).val()},
      function (data) {
        $(data).each(function (k, v) {
          $('#dnor_discharge_destination_stream_no_' + row_id).append(
            $('<option></option>').val(v.stream_no).html(v.display_stream_no)
          );
        });
      },
      'json'
    );
  });

  $('select[id^="dnor_discharge_destination_stream_no_"]').live('change', function (e) {
    var row_id = $(this).attr('row_id');
    $('#dnor_discharge_destination_pressure_' + row_id).val('');
    if ($(this).val() == "") {
      return false;
    }

    $.get('/admin/control_valve_sizings/get_discharge_stream_nos',
      {process_basis_id:$('#dnor_discharge_process_basis_id_' + row_id).val(), stream_no:$(this).val()},
      function (data) {
        $('#dnor_discharge_destination_pressure_' + row_id).val(data['pressure']);
      },
      'json'
    );
  });

  $('#downstream_normal_table input[name=design_circuit]').live('click', function (e) {
    $("input[id^=dnor_discharge_design_circuit_]").val("");
    $('#dnor_discharge_design_circuit_' + $(this).val()).val(true);
  });

  //minimum
  $('select[id^="dmin_discharge_process_basis_id_"]').live('change', function (e) {
    var row_id = $(this).attr('row_id');
    $('#dmin_discharge_destination_stream_no_' + row_id + ' >option').remove();
    $('#dmin_discharge_destination_stream_no_' + row_id).append($('<option></option>').val("").html(""));
    if ($(this).val() == "") {
      return false;
    }

    $.get('/admin/heat_and_material_balances/get_stream_nos',
      {process_basis_id:$(this).val()},
      function (data) {
        $(data).each(function (k, v) {
          $('#dmin_discharge_destination_stream_no_' + row_id).append(
            $('<option></option>').val(v.stream_no).html(v.display_stream_no)
          );
        });
      },
      'json'
    );
  });

  $('select[id^="dmin_discharge_destination_stream_no_"]').live('change', function (e) {
    var row_id = $(this).attr('row_id');
    $('#dmin_discharge_destination_pressure_' + row_id).val('');
    if ($(this).val() == "") {
      return false;
    }

    $.get('/admin/control_valve_sizings/get_discharge_stream_nos',
      {process_basis_id:$('#dmin_discharge_process_basis_id_' + row_id).val(), stream_no:$(this).val()},
      function (data) {
        $('#dmin_discharge_destination_pressure_' + row_id).val(data['pressure']);
      },
      'json'
    );
  });

  $('#downstream_minimum_table input[name=design_circuit]').live('click', function (e) {
    $("input[id^=dmin_discharge_design_circuit_]").val("");
    $('#dmin_discharge_design_circuit_' + $(this).val()).val(true);
  });

  //downstream_circuit_pipings
  $('.circuit_piping_btn').live('click', function (e) {
    var row_id = $(this).attr('row_id');
    if (flow_element_sizing_id == "") {
      alert("Before entering circuit piping values, Please create flow element sizing.")
      return false;
    }
    if ($("#dmax_discharges_id_" + row_id).val() == "" || $("#dnor_discharges_id_" + row_id).val() == "" || $("#dmin_discharges_id_" + row_id).val() == "") {
      alert("Please save the data before entering the circuit piping.")
      return false;
    }

    if ($('#downstream_circuit_piping_box_' + row_id).text() == "") {
      var downstream_circuit_piping_box = $('#downstream_circuit_piping_div').html().replace(/#x#/g, row_id);
      $('#list_of_downstream_circuit_piping').append(downstream_circuit_piping_box);
    }

    $.colorbox({
      href:'#downstream_circuit_piping_box_' + row_id,
      inline:true,
      width:'100%',
      height:'100%',
      onComplete:function () {
        var tr_row_id = parseInt($('#downstream_circuit_piping_box_' + row_id + ' table tr:last td:last a').attr('row_id')) + 1;
        $('#downstream_circuit_piping_box_' + row_id).data({tr_row_id:tr_row_id});
        return false;
      },
      onOpen:function () {
        $('.downstream_condition_basis').text($('#flow_element_sizing_downstream_condition_basis option:selected').text());
        $('.downstream_delta_p_' + $('#flow_element_sizing_downstream_condition_basis').val()).show();
      },
      onClosed:function () {
        $('.downstream_delta_p_' + $('#flow_element_sizing_downstream_condition_basis').val()).hide();
      }
    });

    set_project_unit_decimal1('length_pipe_tube_diameter');
    set_project_unit_decimal1('length_large_dimension_length');
    set_project_unit_decimal1('pressure_differential');
    return false;
  });

  $('.downstream_circuit_piping_add_more').live('click', function (e) {
    var table_id = $(this).attr('table_id');
    var tr_row_id = $('#downstream_circuit_piping_box_' + table_id).data()['tr_row_id'];
    var new_downstream_circuit_pipings_tr = $('#downstream_circuit_pipings_tr').html().replace(/#x#/g, table_id);
    new_downstream_circuit_pipings_tr = new_downstream_circuit_pipings_tr.replace(/#y#/g, tr_row_id);
    $('#downstream_circuit_piping_box_' + table_id + ' table').append($(new_downstream_circuit_pipings_tr));
    $('#downstream_circuit_piping_box_' + table_id).data()['tr_row_id'] = tr_row_id + 1;
    set_project_unit_decimal1('length_pipe_tube_diameter');

    set_project_unit_decimal1('length_pipe_tube_diameter');
    set_project_unit_decimal1('length_large_dimension_length');
    set_project_unit_decimal1('pressure_differential');

    return false;
  });

  $('.downstream_circuit_piping_close').live('click', function (e) {
    $.colorbox.close();
    return false;
  });

  $('.downstream_circuit_piping_close_tr').live('click', function (e) {
    $(this).parents('tr').find('#downstream_circuit_piping_fitting_' + $(this).attr('row_id')).val("");
    deleted_tr($(this).parents('tr'));
    return false;
  });

  //enter_piping
  $('#enter_piping').click(function (e) {
    $.colorbox({
      href:'#piping_box',
      inline:true,
      width:'100%',
      height:'100%',
      onOpen:function () {
        $('#upstream_condition_basis').text($('#flow_element_sizing_upstream_condition_basis option:selected').text());
        $('.delta_p_' + $('#flow_element_sizing_upstream_condition_basis').val()).show();
      },
      onClosed:function () {
        $('.delta_p_' + $('#flow_element_sizing_upstream_condition_basis').val()).hide();
      }
    });
  });

  $('#add_new_suction_piping').click(function (e) {
    var new_piping_tr = $('#new_piping_tr').html().replace(/#x#/g, suction_count);
    $('#piping_table').append($(new_piping_tr));
    suction_count++;
    set_project_unit_decimal1('length_pipe_tube_diameter');
    set_project_unit_decimal1('length_large_dimension_length');
    set_project_unit_decimal1('pressure_differential');
    set_project_unit_decimal1('pressure_general');
    return false;
  });

  $('#close_suction_piping').click(function (e) {
    $.colorbox.close();
    return false;
  });

  $('.suction_piping_close_tr').live('click', function (e) {
    $('#suction_pipings_fitting_' + $(this).attr('suction_piping_id')).val('');
    $(this).parents('tr').hide();
    return false;
  });

  // Suction_piping
  $('.suction_pipings_pipe_size').live('change', function (k) {
    var row_id = $(this).attr('row_id');
    $('#suction_pipings_pipe_id_' + row_id).val('');
    $('#suction_pipings_pipe_schedule_' + row_id + '>option').remove();
    $('#suction_pipings_pipe_schedule_' + row_id).append($('<option></option>').val("").html(""));
    $(pipe_size_schedules[$(this).val()]).each(function (k, v) {
      $('#suction_pipings_pipe_schedule_' + row_id).append($('<option></option>').val(v).html(v));
    });
  });

  $('.suction_pipings_pipe_schedule').live('change', function (k) {
    var row_id = $(this).attr('row_id');
    $('#suction_pipings_pipe_id_' + row_id).val('');
    if ($(this).val() == '') {
      return false;
    }
    var pipe_od = pipe_size_pipe_ods[$('#suction_pipings_pipe_size_' + row_id).val()] / pipe_id_conversion_factor;
    var wall_thickness = pipe_size_wall_thinkness[$('#suction_pipings_pipe_size_' + row_id).val()][$(this).val()] / pipe_id_conversion_factor;
    var pipe_id = pipe_od - (2 * wall_thickness);
    $('#suction_pipings_pipe_id_' + row_id).val(get_project_field_value1('length_pipe_tube_diameter', pipe_id));
  });

  // downstream_circuit_piping
  $('.downstream_circuit_piping_pipe_size').live('change', function (k) {
    var row_id = $(this).attr('row_id');
    $('#downstream_circuit_piping_pipe_id_' + row_id).val('');
    $('#downstream_circuit_piping_pipe_schedule_' + row_id + '>option').remove();
    $('#downstream_circuit_piping_pipe_schedule_' + row_id).append($('<option></option>').val("").html(""));
    $(pipe_size_schedules[$(this).val()]).each(function (k, v) {
      $('#downstream_circuit_piping_pipe_schedule_' + row_id).append($('<option></option>').val(v).html(v));
    });
  });

  $('.downstream_circuit_piping_pipe_schedule').live('change', function (k) {
    var row_id = $(this).attr('row_id');
    $('#downstream_circuit_piping_pipe_id_' + row_id).val('');
    if ($(this).val() == '') {
      return false;
    }
    var pipe_od = pipe_size_pipe_ods[$('#downstream_circuit_piping_pipe_size_' + row_id).val()] / pipe_id_conversion_factor;
    var wall_thickness = pipe_size_wall_thinkness[$('#downstream_circuit_piping_pipe_size_' + row_id).val()][$(this).val()] / pipe_id_conversion_factor;
    var pipe_id = pipe_od - (2 * wall_thickness);
    $('#downstream_circuit_piping_pipe_id_' + row_id).val(get_project_field_value1('length_pipe_tube_diameter', pipe_id));
  });

  $("#upstream_calculate").click(function () {

    $('#tab').val($("ul.simple-tabs li.active a").attr('tab'));
    $('#calculate_btn').val('upstream_calculate');
    if (form_validations() == false) {
      return false;
    }
    if (flow_element_sizing_id == "" || $('form.form_flow_element').isDirty()) {
      $('form.form_flow_element').submit();
      return false;
    }

    $.get("/admin/flow_element_sizings/upstream_calculate",
      {flow_element_sizing_id:flow_element_sizing_id},
      function (data) {
        alert('Calculation is completed successfully');
        window.location = location.pathname
      },
      'json'
    ).error(
      function () {
        alert("error");
      }
    );
  });


  $("#flow_element_sizing_os_pipe_schedule").change(function () {
    var pipe_schedule = $("option:selected", this).text();
    var pipe_size = $("#flow_element_sizing_os_pipe_size").val();

    $.get("/admin/flow_element_sizings/get_pipe_diameter",
      {pipe_schedule:pipe_schedule, pipe_size:pipe_size},
      function (data) {
        $("#os_pipe_id").empty().append(data.pipe_diameter)
      });
  });
  $("#flow_element_sizing_os_restriction_type").change(function () {
    var type = $("option:selected", this).text();
    $.get("/admin/flow_element_sizings/get_orifice_types",
      {restriction_type:type},
      function (data) {
        $("#flow_element_sizing_os_orifice_type").empty();
        $.each(data, function (index, value) {
          $("#flow_element_sizing_os_orifice_type").append($("<option></option>").val(value).html(value));
        })

      });

  });

  $("#downstream_calculate").click(function () {

    $('#tab').val($("ul.simple-tabs li.active a").attr('tab'));
    $('#calculate_btn').val('downstream_calculate');
    if (form_validations() == false) {
      return false;
    }
    if (flow_element_sizing_id == "" || $('form.form_flow_element').isDirty()) {
      $('form.form_flow_element').submit();
      return false;
    }

    $.get("/admin/flow_element_sizings/downstream_calculate",
      {flow_element_sizing_id:flow_element_sizing_id},
      function (data) {
        alert('Calculation is completed successfully');
        window.location = location.pathname
      },
      'json'
    ).error(
      function () {
        alert("error");
      }
    );

  });

  $('#orifice_design').click(function () {
    $('#tab').val($("ul.simple-tabs li.active a").attr('tab'));
    $('#calculate_btn').val('orifice_design');
    if (form_validations() == false) {
      return false;
    }
    if (flow_element_sizing_id == "" || $('form.form_flow_element').isDirty()) {
      $('form.form_flow_element').submit();
      return false;
    }

    $.get("/admin/flow_element_sizings/orifice_design",
      {flow_element_sizing_id:flow_element_sizing_id},
      function (data) {
        alert('Calculation is completed successfully');
        window.location = location.pathname
      },
      'json'
    ).error(
      function () {
        alert("error");
      }
    );

  });
</script>
<%= javascript_tag do %>
  //hit calculate button
  var calculate_btn = "<%= params[:calculate_btn] %>";
  if(calculate_btn == "upstream_calculate") {
  $('#upstream_calculate').trigger('click');
  } else if (calculate_btn == "downstream_calculate") {
  $('#downstream_calculate').trigger('click');
  } else if (calculate_btn == "orifice_design") {
  $("#orifice_design").trigger('click');
  }
<% end %>
